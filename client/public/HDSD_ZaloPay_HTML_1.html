

<!DOCTYPE html>
<html>
<head>
  <link rel="apple-touch-icon" sizes="60x60" href="../../images/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="../../images/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="../../images/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="../../images/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="../../images/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="../../images/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="../../images/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="../../images/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="../../images/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="../../images/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon/favicon-16x16.png">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="../../images/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta charset="utf-8">
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:url" content="https://docs.zalopay.vn/" />
  <meta property="og:title" content="ZaloPay Developer" />
  <meta property="og:image" content="https://docs.zalopay.vn/images/logo-zalopay.png" />
  <meta property="og:description" content="Trang tài liệu hướng dẫn tích hợp ZaloPay" />

    <meta data-env name="grecaptcha_site_key" content="6LdiA5cUAAAAAO19uw3VP3y8R_THYZiqpn2GeVGq">
    <meta data-env name="mwebtoapp_api" content="https://zalopay.com.vn/openapp/pay.html">
    <meta data-env name="docs_ver" content="v1">
    <meta data-env name="env" content="pro">
    <meta data-env name="demo_api_host" content="https://zlpdev-mi-zlpdemo.zalopay.vn/zlp-demo/api">
    <meta data-env name="demo_api_v2_host" content="https://zlpdev-mi-zlpdemo.zalopay.vn/zlp-demo/v2/api">
    <meta data-env name="demo_ws_v2" content="wss://mep.zpapps.vn/v2/zlp-demo/subscribe">
    <meta data-env name="demo_ws" content="wss://mep.zpapps.vn/zlp-demo/subscribe">

  <link rel="stylesheet" href="../../font-awesome/css/font-awesome.min.css">

  <title>Danh sách API - ZaloPay Developer</title>
  <style>
    .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .c, .highlight .cd {
  color: #5e5d83;
  font-style: italic;
}
.highlight .cm {
  color: #5e5d83;
  font-style: italic;
}
.highlight .c1 {
  color: #5e5d83;
  font-style: italic;
}
.highlight .cp {
  color: #465457;
  font-weight: bold;
}
.highlight .cs {
  color: #465457;
  font-weight: bold;
  font-style: italic;
}
.highlight .err {
  color: #f8f8f2;
  background-color: #403d3d;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .ge {
  color: #1b1d1e;
  font-style: italic;
}
.highlight .gr {
  color: #f92672;
}
.highlight .gt {
  color: #f92672;
}
.highlight .gh {
  color: #403d3d;
}
.highlight .go {
  color: #403d3d;
}
.highlight .gp {
  color: #66d9ef;
}
.highlight .gs {
  font-weight: bold;
}
.highlight .gu {
  color: #465457;
}
.highlight .k, .highlight .kv {
  color: #66d9ef;
  font-weight: bold;
}
.highlight .kc {
  color: #66d9ef;
  font-weight: bold;
}
.highlight .kd {
  color: #66d9ef;
  font-weight: bold;
}
.highlight .kp {
  color: #66d9ef;
  font-weight: bold;
}
.highlight .kr {
  color: #66d9ef;
  font-weight: bold;
}
.highlight .kt {
  color: #66d9ef;
  font-weight: bold;
}
.highlight .kn {
  color: #f92672;
  font-weight: bold;
}
.highlight .ow {
  color: #f92672;
  font-weight: bold;
}
.highlight .o {
  color: #f92672;
  font-weight: bold;
}
.highlight .mf {
  color: #af87ff;
}
.highlight .mh {
  color: #af87ff;
}
.highlight .il {
  color: #af87ff;
}
.highlight .mi {
  color: #af87ff;
}
.highlight .mo {
  color: #af87ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #af87ff;
}
.highlight .se {
  color: #af87ff;
}
.highlight .sb {
  color: #d7d787;
}
.highlight .sc {
  color: #d7d787;
}
.highlight .sd {
  color: #d7d787;
}
.highlight .s2 {
  color: #d7d787;
}
.highlight .sh {
  color: #d7d787;
}
.highlight .si {
  color: #d7d787;
}
.highlight .sx {
  color: #d7d787;
}
.highlight .sr {
  color: #d7d787;
}
.highlight .s1 {
  color: #d7d787;
}
.highlight .ss {
  color: #d7d787;
}
.highlight .s {
  color: #d7d787;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
  font-weight: bold;
}
.highlight .nd {
  color: #a6e22e;
  font-weight: bold;
}
.highlight .ne {
  color: #a6e22e;
  font-weight: bold;
}
.highlight .nf {
  color: #a6e22e;
  font-weight: bold;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .bp {
  color: #f8f8f2;
}
.highlight .nb {
  color: #f8f8f2;
}
.highlight .ni {
  color: #f8f8f2;
}
.highlight .nn {
  color: #f8f8f2;
}
.highlight .vc {
  color: #f8f8f2;
}
.highlight .vg {
  color: #f8f8f2;
}
.highlight .vi {
  color: #f8f8f2;
}
.highlight .nv {
  color: #f8f8f2;
}
.highlight .w {
  color: #f8f8f2;
}
.highlight .nl {
  color: #f8f8f2;
  font-weight: bold;
}
.highlight .nt {
  color: #f92672;
}
.highlight {
  color: #f8f8f2;
  background-color: #1b1d1e;
}
  </style>

  <link href="../../stylesheets/material-kit.css" rel="stylesheet" />
  <link href="../../stylesheets/screen.css" rel="stylesheet" media="screen" />
  <link href="../../stylesheets/print.css" rel="stylesheet" media="print" />
  <link href="../../stylesheets/zlp-styles.css" rel="stylesheet" />

</head>
<body class="v2 v2_general v2_general_overview">
  <nav class="navbar navbar-show fixed-top navbar-expand-xl p-0" id="header">
    <div class="container-fluid px-4">
      <a class="navbar-brand p-0 mr-0" href="/"><img src="../../images/logo-zalopay.png" alt="Logo zalopay" /></a>
      <label for="search" class="text-dark mr-3 mr-sm-auto search rounded border py-2 ml-3 ml-sm-4 my-0">
        <i class="fa fa-search mr-2"></i>
        <input id="search" class="border-0 text-main" placeholder="Tìm kiếm ..."
          onfocus="$('.search').addClass('focus')"
          onblur="$('.search').removeClass('focus')" maxlength="32" />
      </label>
      <button class="navbar-toggler" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="navbar-toggler-icon"></span>
        <span class="navbar-toggler-icon"></span>
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" style="flex-grow: 0;">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link " href="/start/">
              BẮT ĐẦU
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="/general/overview.html">
              Danh sách API
            </a>
          </li>
          <li class="dropdown nav-item" >
            <a href="javascript:void(0);" class="dropdown-toggle nav-link ">
            GIẢI PHÁP THANH TOÁN
            </a>
            <div class="dropdown-menu dropdown-with-icons p-0 m-0">
                <a href="/payments/vietqr/overview.html" class="dropdown-item ">Thanh toán ZaloPay QR đa năng</a>
                <a href="/payments/applepay/overview.html" class="dropdown-item ">Thanh toán Apple Pay</a>
                <a href="/payments/gateway/overview.html" class="dropdown-item ">Cổng ZaloPay</a>
                <a href="/payments/qrcode/overview.html" class="dropdown-item ">Thanh toán QR động</a>
                <a href="/payments/staticqr/overview.html" class="dropdown-item ">Thanh toán QR tĩnh</a>
                <a href="/payments/quickpay/overview.html" class="dropdown-item ">Thanh toán Quickpay</a>
                <a href="/payments/agreement/overview.html" class="dropdown-item ">Thanh toán tự động</a>
                <a href="/payments/payonship/overview.html" class="dropdown-item ">Thanh toán khi nhận hàng</a>
                <a href="/payments/disbursement/overview.html" class="dropdown-item ">Chi hộ</a>
            </div>
          </li>
          <li class="dropdown nav-item" >
            <a href="javascript:void(0);" class="dropdown-toggle nav-link ">
            MÔ HÌNH TÍCH HỢP
            </a>
            <div class="dropdown-menu dropdown-with-icons p-0 m-0">
                <a href="/docs/vietqr/overview.html" class="dropdown-item ">Thanh toán ZaloPay QR đa năng</a>
                <a href="/docs/applepay/overview.html" class="dropdown-item ">Thanh toán Apple Pay</a>
                <a href="/docs/shopify/overview.html" class="dropdown-item ">Tích hợp thanh toán trên Shopify</a>
                <a href="/docs/gateway/overview.html" class="dropdown-item ">Website - Cổng</a>
                <a href="/docs/webtoapp/overview.html" class="dropdown-item ">Website - Web to App</a>
                <a href="/docs/apptoapp/overview.html" class="dropdown-item ">Mobile - App to App</a>
                <a href="/docs/mobilewebtoapp/overview.html" class="dropdown-item ">Mobile - Mobile Web to App</a>
                <a href="/docs/qrcode/overview.html" class="dropdown-item ">POS - QR động</a>
                <a href="/docs/quickpay/overview.html" class="dropdown-item ">POS - QuickPay</a>
                <a href="/docs/webinapp/overview.html" class="dropdown-item ">Web in App</a>
                <a href="/docs/staticqr/overview.html" class="dropdown-item ">QR tĩnh tại quầy</a>
            </div>
          </li>
          <li class="dropdown nav-item">
            <a href="javascript:void(0);" class="dropdown-toggle nav-link ">
              REFERENCE
            </a>
            <div class="dropdown-menu dropdown-with-icons p-0 m-0">
                <a href="/reference/errors/overview.html" class="dropdown-item ">Thông tin mã trạng thái</a>
                <a href="/reference/common/overview.html" class="dropdown-item ">Các lỗi thường gặp</a>
                <a href="/downloads/" class="dropdown-item ">DOWNLOAD</a>
                <a href="/reference/faq/overview.html" class="dropdown-item ">F.A.Q</a>
                <a href="/#support" class="dropdown-item ">LIÊN HỆ</a>
            </div>
          </li>
          <li class="nav-item">|</li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="javascript:void(0);" id="versionCurr" >
              Version
            </a>
            <div class="dropdown-menu dropdown-with-icons p-0 m-0">
              <a id="version1Id" class="dropdown-item" href="javascript:void(0);">Version 1</a>
              <a id="version2Id" class="dropdown-item" href="javascript:void(0);">Version 2</a>
              <a id="versionBeta" class="dropdown-item" href="https://beta-docs.zalopay.vn/docs/guides/intro" target="_blank">Beta Version</a>
            </div>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="javascript:void(0);" id="languageCurr" >
              Tiếng việt
            </a>
            <div class="dropdown-menu dropdown-with-icons dropdown-menu-right p-0 m-0">
              <a id="viId" class="dropdown-item" href="javascript:void(0);">Tiếng Việt</a>
              <a id="enId" class="dropdown-item" href="javascript:void(0);">English</a>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>

    <a href="#" class="text-white" id="nav-button" style="transform: translateY(74px)">
    <span class="text-white" style="background-color: #1e88e5">
      NAV
    </span>
  </a>
  <div class="toc-wrapper">
    <ul class="toc-nav">
        <li class="toc-nav__link">
          <a href="#" class="active arrow arrow-down">Danh sách API
          </a>
          <ul>
            <li>
              <a href="/general/overview.html" class="toc-h0 toc-link active" title="docs.general.api_list.main_title">Danh sách API</a>
                <ul id="toc">
                  <li>
                    <a href="#tao-don-hang" class="toc-h1 toc-link arrow" title="Tạo đơn hàng">
                        <span>Tạo đơn hàng</span>
                    </a>
                      <ul class="toc-list-h2">
                          <li>
                            <a href="#tao-don-hang_luong-xu-ly" class="toc-h2 toc-link" title="Luồng xử lý">- Luồng xử lý</a>
                          </li>
                          <li>
                            <a href="#tao-don-hang_dac-ta-api" class="toc-h2 toc-link" title="Đặc tả API">- Đặc tả API</a>
                          </li>
                          <li>
                            <a href="#tao-don-hang_thong-tin-don-hang" class="toc-h2 toc-link" title="Thông tin đơn hàng">- Thông tin đơn hàng</a>
                          </li>
                          <li>
                            <a href="#tao-don-hang_tham-so-api-tra-ve" class="toc-h2 toc-link" title="Tham số api trả về">- Tham số api trả về</a>
                          </li>
                          <li>
                            <a href="#tao-don-hang_code-mau" class="toc-h2 toc-link" title="Code mẫu">- Code mẫu</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#callback" class="toc-h1 toc-link arrow" title="Callback">
                        <span>Callback</span>
                    </a>
                      <ul class="toc-list-h2">
                          <li>
                            <a href="#callback_luong-xu-ly" class="toc-h2 toc-link" title="Luồng xử lý">- Luồng xử lý</a>
                          </li>
                          <li>
                            <a href="#callback_dac-ta-api" class="toc-h2 toc-link" title="Đặc tả API">- Đặc tả API</a>
                          </li>
                          <li>
                            <a href="#callback_code-mau" class="toc-h2 toc-link" title="Code mẫu">- Code mẫu</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#truy-van-trang-thai-thanh-toan-cua-don-hang" class="toc-h1 toc-link arrow" title="Truy vấn trạng thái thanh toán của đơn hàng">
                        <span>Truy vấn trạng thái thanh toán của đơn hàng</span>
                    </a>
                      <ul class="toc-list-h2">
                          <li>
                            <a href="#truy-van-trang-thai-thanh-toan-cua-don-hang_luong-xu-ly" class="toc-h2 toc-link" title="Luồng xử lý">- Luồng xử lý</a>
                          </li>
                          <li>
                            <a href="#truy-van-trang-thai-thanh-toan-cua-don-hang_dac-ta-api" class="toc-h2 toc-link" title="Đặc tả API">- Đặc tả API</a>
                          </li>
                          <li>
                            <a href="#truy-van-trang-thai-thanh-toan-cua-don-hang_code-mau" class="toc-h2 toc-link" title="Code mẫu">- Code mẫu</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#hoan-tien-giao-dich" class="toc-h1 toc-link arrow" title="Hoàn tiền giao dịch">
                        <span>Hoàn tiền giao dịch</span>
                    </a>
                      <ul class="toc-list-h2">
                          <li>
                            <a href="#hoan-tien-giao-dich_luong-xu-ly" class="toc-h2 toc-link" title="Luồng xử lý">- Luồng xử lý</a>
                          </li>
                          <li>
                            <a href="#hoan-tien-giao-dich_dac-ta-api" class="toc-h2 toc-link" title="Đặc tả API">- Đặc tả API</a>
                          </li>
                          <li>
                            <a href="#hoan-tien-giao-dich_code-mau" class="toc-h2 toc-link" title="Code mẫu">- Code mẫu</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#truy-van-trang-thai-hoan-tien-queryrefund" class="toc-h1 toc-link arrow" title="Truy vấn trạng thái hoàn tiền - QueryRefund">
                        <span>Truy vấn trạng thái hoàn tiền - QueryRefund</span>
                    </a>
                      <ul class="toc-list-h2">
                          <li>
                            <a href="#truy-van-trang-thai-hoan-tien-queryrefund_luong-xu-ly" class="toc-h2 toc-link" title="Luồng xử lý">- Luồng xử lý</a>
                          </li>
                          <li>
                            <a href="#truy-van-trang-thai-hoan-tien-queryrefund_dac-ta-api" class="toc-h2 toc-link" title="Đặc tả API">- Đặc tả API</a>
                          </li>
                          <li>
                            <a href="#truy-van-trang-thai-hoan-tien-queryrefund_code-mau" class="toc-h2 toc-link" title="Code mẫu">- Code mẫu</a>
                          </li>
                      </ul>
                  </li>
                </ul>
            </li>
            <li>
              <a href="/general/../reference/errors/overview.html" class="toc-h0 toc-link " title="docs.general.error_info.main_title">Thông tin mã trạng thái</a>
            </li>
          </ul>
        </li>
    </ul>
  </div>
  <div class="page-wrapper doc">
    <h1 class="content__title text-zlp">
      Danh sách API
    </h1>
    <div class="tabbar">
        <a href="/general/overview.html" class="active">Danh sách API</a>
        <a href="/general/../reference/errors/overview.html" class="">Thông tin mã trạng thái</a>
    </div>
    <div class="content single-col">
      <h1 class='anchor-head' id='tao-don-hang'>Tạo đơn hàng</h1>
<p>App server gửi thông tin đơn hàng tới ZaloPay server để tạo đơn hàng.</p>
<h2 class='anchor-head' id='tao-don-hang_luong-xu-ly'>Luồng xử lý</h2>
<p><img src="../../images/v2/createorder-v2.png" alt="Sequence Flow" /></p>
<h2 class='anchor-head' id='tao-don-hang_dac-ta-api'>Đặc tả API</h2>
<table><thead>
<tr>
<th>Environment</th>
<th>Method</th>
<th>Endpoint</th>
</tr>
</thead><tbody>
<tr>
<td><span class="code bg-orange">Sandbox</span></td>
<td><span class="code bg-primary mr-1">POST</span></td>
<td>https://sb-openapi.zalopay.vn/v2/create</td>
</tr>
<tr>
<td><span class="code bg-danger">Real</span></td>
<td><span class="code bg-primary mr-1">POST</span></td>
<td>https://openapi.zalopay.vn/v2/create</td>
</tr>
</tbody></table>

<ul>
<li><strong>Content-Type</strong>:</li>
</ul>

<p><code>application/x-www-form-urlencoded</code></p>

<p><code>application/json</code></p>

<p><code>application/xml</code></p>
<h2 class='anchor-head' id='tao-don-hang_thong-tin-don-hang'>Thông tin đơn hàng</h2>
<p>Đơn hàng gồm có các thông tin sau:</p>

<table><thead>
<tr>
<th style="text-align: left"><div style="width:130px">Tham số</div></th>
<th style="text-align: left">Kiểu dữ liệu</th>
<th style="text-align: left">Kích thước</th>
<th style="text-align: left">Bắt buộc</th>
<th style="text-align: left">Ý nghĩa</th>
<th style="text-align: left">Ví dụ</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>app_id</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left"></td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Định danh cho ứng dụng đã được cấp khi đăng ký ứng dụng với ZaloPay.</td>
<td style="text-align: left"><code>1</code></td>
</tr>
<tr>
<td style="text-align: left"><code>app_user</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">50</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Thông tin định danh của người dùng ứng dụng thanh toán đơn hàng: id/username/tên/số điện thoại/email của user. Nếu không định danh được có thể dùng thông tin mặc định, chằng hạn như tên ứng dụng</td>
<td style="text-align: left"><code>user123</code></td>
</tr>
<tr>
<td style="text-align: left"><code>app_trans_id</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">40</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Mã giao dịch của đơn hàng. Mã giao dịch phải bắt đầu theo format <strong>yymmdd</strong> của ngày hiện tại và nên theo format <strong>yymmddMã đơn hàng thanh toán</strong> <p><span class="code bg-info">Lưu ý:</span> <strong>yymmdd</strong>  phải đúng TimeZone Vietnam (GMT+7) (Vì các giao dịch đối soát theo ngày giờ Việt Nam)</p></td>
<td style="text-align: left"><code>180208_007242</code></td>
</tr>
<tr>
<td style="text-align: left"><code>app_time</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left"></td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Thời gian tạo đơn hàng (unix timestamp in milisecond). Thời gian tính đến milisecond, lấy theo current time và không quá 15 phút so với thời điểm thanh toán</td>
<td style="text-align: left"><code>1459823610957</code></td>
</tr>
<tr>
<td style="text-align: left"><code>expire_duration_seconds</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
<td style="text-align: left">Thời gian hết hạn của đơn hàng. Thời gian tính bằng giây (giá trị nhỏ nhất: 300, giá trị lớn nhất: 2592000)</td>
<td style="text-align: left"><code>900</code></td>
</tr>
<tr>
<td style="text-align: left"><code>amount</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left"></td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Giá trị của đơn hàng VND</td>
<td style="text-align: left"><code>50000</code></td>
</tr>
<tr>
<td style="text-align: left"><code>item</code></td>
<td style="text-align: left">JSON Array String</td>
<td style="text-align: left">2048</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Item của đơn hàng, do ứng dụng tự định nghĩa</td>
<td style="text-align: left"><code>[{&quot;itemid&quot;:&quot;knb&quot;,&quot;itename&quot;:&quot;kim nguyen bao&quot;,&quot;itemprice&quot;:198400,&quot;itemquantity&quot;:1}]</code></td>
</tr>
<tr>
<td style="text-align: left"><code>description</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">256</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Thông tin mô tả về dịch vụ đang được thanh toán dùng để hiển thị cho user trên app ZaloPay và trên tool quản lý Merchant</td>
<td style="text-align: left"><code>&lt;Tên Merchant/Dịch vụ&gt; - Thanh toán đơn hàng #&lt;Mã đơn hàng&gt;</code> <br/> Ví dụ: <br/> <code>Lazada - Thanh toán đơn hàng #180208_007242</code></td>
</tr>
<tr>
<td style="text-align: left"><code>embed_data</code></td>
<td style="text-align: left">JSON String</td>
<td style="text-align: left">1024</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Dữ liệu riêng của đơn hàng. Dữ liệu này sẽ được <a href="#callback">callback</a> lại cho AppServer khi thanh toán thành công (Nếu không có thì để chuỗi rỗng)</td>
<td style="text-align: left"><code>{&quot;promotioninfo&quot;:&quot;&quot;,&quot;merchantinfo&quot;:&quot;du lieu rieng cua ung dung&quot;}</code></td>
</tr>
<tr>
<td style="text-align: left"><code>bank_code</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">20</td>
<td style="text-align: left">&#10004; (*)</td>
<td style="text-align: left">Mã ngân hàng, <a href="/docs/gateway/api.html#lay-danh-sach-cac-ngan-hang-duoc-ho-tro">xem cách lấy danh sách các ngân hàng được hỗ trợ</a></td>
<td style="text-align: left"><code>VTB</code></td>
</tr>
<tr>
<td style="text-align: left"><code>mac</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left"></td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Thông tin chứng thực của đơn hàng, <a href="/general/overview.html#tao-don-hang_thong-tin-don-hang_tao-thong-tin-chung-thuc">xem cách tạo thông tin chứng thực cho đơn hàng</a></td>
<td style="text-align: left"><code>c8f49d523336f0a182586a70b71c20da96 4d37954711de9273152b500df74c0d</code></td>
</tr>
<tr>
<td style="text-align: left"><code>callback_url</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
<td style="text-align: left">ZaloPay sẽ thông báo trạng thái thanh toán của đơn hàng khi thanh toán hoàn tất. Nếu không được cung cấp, callback_url mặc định của ứng dụng sẽ được sử dụng.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><code>device_info</code></td>
<td style="text-align: left">JSON String</td>
<td style="text-align: left">256</td>
<td style="text-align: left"></td>
<td style="text-align: left">Chuỗi JSON mô tả thông tin của thiết bị</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><code>sub_app_id</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">50</td>
<td style="text-align: left"></td>
<td style="text-align: left">Định danh dịch vụ / nhóm dịch vụ đối tác đăng ký với ZaloPay (chỉ áp dụng với một số đối tác đặc biệt)</td>
<td style="text-align: left"><code>sub123</code></td>
</tr>
<tr>
<td style="text-align: left"><code>title</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">256</td>
<td style="text-align: left"></td>
<td style="text-align: left">Tiêu đề đơn hàng.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><code>currency</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
<td style="text-align: left">Đơn vị tiền tệ.  Mặc định là VND</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><code>phone</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">50</td>
<td style="text-align: left"></td>
<td style="text-align: left">Số điện thoại của người dùng</td>
<td style="text-align: left"><code>0934568239</code></td>
</tr>
<tr>
<td style="text-align: left"><code>email</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">100</td>
<td style="text-align: left"></td>
<td style="text-align: left">Email của người dùng</td>
<td style="text-align: left"><code>example@gmail.com</code></td>
</tr>
<tr>
<td style="text-align: left"><code>address</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">1024</td>
<td style="text-align: left"></td>
<td style="text-align: left">Địa chỉ của người dùng</td>
<td style="text-align: left"><code>TPHCM</code></td>
</tr>
</tbody></table>

<aside class="alert alert-primary">
  <b>Chú thích bank_code (*)</b>
  <ul class="mt-2 mb-0">
    <li>Đối với mô hình <strong>Thanh toán QR</strong>, <strong>App to App</strong>, thì bank_code là không bắt buộc</li>
    <li>Đối với mô hình <strong>Mobile Web to App</strong>, thì bank_code bắt buộc phải là <code>zalopayapp</code></li>
    <li>Đối với mô hình <strong>Cổng ZaloPay</strong>, thì <a href="/docs/gateway/api.html#mo-ta_dac-ta-api_vi-du-cac-truong-hop-bankcode">xem thêm ở đây</a></li>
  </ul>
</aside>
<h3 class='anchor-head' id='tao-don-hang_thong-tin-don-hang_mot-so-truong-dac-biet-cua-embed_data'>Một số trường đặc biệt của embed_data</h3>
<table><thead>
<tr>
<th><div style="width:135px">Tên</div></th>
<th>Kiểu dữ liệu</th>
<th>Định dạng</th>
<th>Mô tả</th>
<th>Ví dụ</th>
</tr>
</thead><tbody>
<tr>
<td><code>preferred_payment_method</code></td>
<td>Array String</td>
<td><code>[&quot;domestic_card&quot;, &quot;vietqr&quot;, &quot;...&quot;]</code> <br/><a href="../docs/gateway/guide.html#2-1-theo-cau-truc-moi">Xem chi tiết cách khai báo tại đây</a></td>
<td>Dùng để hiển thị phương thức thanh toán tùy chọn trên cổng ZaloPay.</td>
<td><code>{&quot;preferred_payment_method&quot;:[&quot;vietqr&quot;]}</code></td>
</tr>
<tr>
<td><code>redirecturl</code></td>
<td>String</td>
<td>URL</td>
<td>Redirect về url này sau khi thanh toán trên cổng ZaloPay (override redirect url lúc đăng ký app với ZaloPay)</td>
<td><code>{&quot;redirecturl&quot;: &quot;https://docs.zalopay.vn/result&quot;}</code></td>
</tr>
<tr>
<td><code>columninfo</code></td>
<td>JSON String</td>
<td><code>{&quot;column_name&quot;: &quot;value&quot;}</code></td>
<td>Thêm thông tin hiển thị ở phần <a href="https://mc.zalopay.vn/translog"><strong>Quản lý giao dịch chi tiết</strong></a> trên <a href="https://mc.zalopay.vn">Merchant site</a>, nếu cột chưa tồn tại cần vào phần <a href="https://mc.zalopay.vn/cfg-column"><strong>Cài đặt hiển thị dữ liệu</strong></a> để cấu hình<br><strong><em>Lưu ý</em></strong>: đối với thanh toán Offline cần thiết truyền các thông tin như branch_id, store_id, store_name, ...</td>
<td><code>{&quot;columninfo&quot;: &quot;{\&quot;branch_id\&quot;: \&quot;HCM\&quot;,\&quot;store_id\&quot;: \&quot;CH123\&quot;,\&quot;store_name\&quot;: \&quot;Saigon Centre\&quot;,\&quot;mc_campaign_id\&quot;: \&quot;FREESHIP\&quot;}&quot;}</code></td>
</tr>
<tr>
<td><code>promotioninfo</code></td>
<td>JSON String</td>
<td><code>{&quot;campaigncode&quot;:&quot;code&quot;}</code></td>
<td>Dùng để triển khai chương trình khuyến mãi</td>
<td><code>{&quot;promotioninfo&quot;: &quot;{\&quot;campaigncode\&quot;:\&quot;blackfriday\&quot;}&quot;}</code></td>
</tr>
<tr>
<td><code>zlppaymentid</code></td>
<td>String</td>
<td></td>
<td>- Mã thông tin thanh toán.<br> - Chỉ truyền khi đối tác cần nhận tiền đối soát về nhiều tài khoản khác nhau.<br> - Hệ thống ZaloPay sẽ tạo ra một mã Thanh toán (tương ứng với mỗi Tài khoản ngân hàng đối tác cung cấp) và gởi lại cho đối tác thiết lập.</td>
<td><code>{&quot;zlppaymentid&quot;: &quot;P4201372&quot;}</code></td>
</tr>
</tbody></table>
<h3 class='anchor-head' id='tao-don-hang_thong-tin-don-hang_tao-thong-tin-chung-thuc'>Tạo thông tin chứng thực</h3><pre class="highlight shell tab-shell"><code>mac <span class="o">=</span> HMAC<span class="o">(</span>hmac_algorihtm, key1, hmac_input<span class="o">)</span>
</code></pre>
<p><strong>Trong đó:</strong></p>

<ul>
<li><strong>hmac_algorithm</strong>: Là phương thức bảo mật do ứng dụng đăng ký với ZaloPay, mặc định là <code>HmacSHA256</code></li>
<li><strong>key1</strong>: Là Mac Key do ZaloPay cung cấp cho ứng dụng lúc đăng ký ứng dụng</li>
<li><strong>hmac_input</strong>: <code>app_id +”|”+ app_trans_id +”|”+ app_user +”|”+ amount +&quot;|&quot;+ app_time +”|”+ embed_data +&quot;|&quot;+ item</code></li>
</ul>

<p><strong>Ví dụ:</strong></p>

<ul>
<li><strong>Content-Type: <code>application/json</code></strong></li>
</ul>
<pre class="highlight json tab-json"><code><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="s2">"app_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2553</span><span class="p">,</span><span class="w">
    </span><span class="s2">"app_user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ZaloPayDemo"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"app_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">1660717311101</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w">
    </span><span class="s2">"app_trans_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"220817_1660717311101"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"bank_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zalopayapp"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"embed_data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{}"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"item"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[]"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"callback_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;https://domain.com/callback&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ZaloPayDemo - Thanh toán cho đơn hàng #220817_1660717311101"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"mac"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cf0ff27956f4d6203ce4a2c55691d81b65de2d640ee65e95ae5627ce801cd962"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre><pre class="highlight shell tab-shell"><code>hmac_input: 2553|220817_1660717311101|ZaloPayDemo|10000|1660717311101|<span class="o">{}</span>|[]
mac: cf0ff27956f4d6203ce4a2c55691d81b65de2d640ee65e95ae5627ce801cd962
</code></pre>
<p><br></p>

<ul>
<li><strong>Content-Type: <code>application/x-www-form-urlencoded</code></strong></li>
</ul>
<pre class="highlight xml tab-xml"><code>
app_id=2553<span class="err">&amp;</span>app_trans_id=220817_1660717311101<span class="err">&amp;</span>app_user=ZaloPayDemo<span class="err">&amp;</span>app_time=1660717311101<span class="err">&amp;</span>description=ZaloPayDemo - Thanh toán cho đơn hàng #220817_1660717311101<span class="err">&amp;</span>embed_data={}<span class="err">&amp;</span>item=[]<span class="err">&amp;</span>amount=10000<span class="err">&amp;&amp;</span>mac=cf0ff27956f4d6203ce4a2c55691d81b65de2d640ee65e95ae5627ce801cd962

</code></pre><pre class="highlight shell tab-shell"><code>hmac_input: 2553|220817_1660717311101|ZaloPayDemo|10000|1660717311101|<span class="o">{}</span>|[]
mac: cf0ff27956f4d6203ce4a2c55691d81b65de2d640ee65e95ae5627ce801cd962
</code></pre>
<p><br></p>

<ul>
<li><strong>Content-Type: <code>application/xml</code></strong></li>
</ul>
<pre class="highlight xml tab-xml"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;OAOrder&gt;</span>
    <span class="nt">&lt;app_id&gt;</span>2553<span class="nt">&lt;/app_id&gt;</span>
    <span class="nt">&lt;app_user&gt;</span>ZaloPayDemo<span class="nt">&lt;/app_user&gt;</span>
    <span class="nt">&lt;app_trans_id&gt;</span>220817_1660717311101/app_trans_id&gt;
    <span class="nt">&lt;app_time&gt;</span>1660717311101<span class="nt">&lt;/app_time&gt;</span>
    <span class="nt">&lt;amount&gt;</span>10000<span class="nt">&lt;/amount&gt;</span>
    <span class="nt">&lt;order_type&gt;</span>GOODS<span class="nt">&lt;/order_type&gt;</span>
    <span class="nt">&lt;title&gt;</span>string<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;description&gt;</span>ZaloPayDemo - Thanh toán cho đơn hàng #220817_1660717311101<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;redirect_url&gt;</span>string<span class="nt">&lt;/redirect_url&gt;</span>
    <span class="nt">&lt;device_info&gt;</span>string<span class="nt">&lt;/device_info&gt;</span>
    <span class="nt">&lt;item&gt;</span>[]<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;embed_data&gt;</span>{}<span class="nt">&lt;/embed_data&gt;</span>
    <span class="nt">&lt;mac&gt;</span>cf0ff27956f4d6203ce4a2c55691d81b65de2d640ee65e95ae5627ce801cd962<span class="nt">&lt;/mac&gt;</span>
    <span class="nt">&lt;currency&gt;</span>VND<span class="nt">&lt;/currency&gt;</span>
    <span class="nt">&lt;bank_code&gt;</span>zalopayapp<span class="nt">&lt;/bank_code&gt;</span>
    <span class="nt">&lt;phone&gt;</span>string<span class="nt">&lt;/phone&gt;</span>
    <span class="nt">&lt;email&gt;</span>string<span class="nt">&lt;/email&gt;</span>
    <span class="nt">&lt;address&gt;</span>string<span class="nt">&lt;/address&gt;</span>
<span class="nt">&lt;/OAOrder&gt;</span>

</code></pre><pre class="highlight shell tab-shell"><code>hmac_input: 2553|220817_1660717311101|ZaloPayDemo|10000|1660717311101|<span class="o">{}</span>|[]
mac: cf0ff27956f4d6203ce4a2c55691d81b65de2d640ee65e95ae5627ce801cd962
</code></pre>
<p><br></p>
<h2 class='anchor-head' id='tao-don-hang_tham-so-api-tra-ve'>Tham số api trả về</h2>
<table><thead>
<tr>
<th style="text-align: left">Tham số</th>
<th style="text-align: left">Kiểu dữ liệu</th>
<th style="text-align: left">Ý nghĩa</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>return_code</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left"><p><code>1</code>: Thành công</p><p><code>2</code>: Thất bại</p></td>
</tr>
<tr>
<td style="text-align: left"><code>return_message</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Mô tả mã trạng thái</td>
</tr>
<tr>
<td style="text-align: left"><code>sub_return_code</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left">Mã trạng thái chi tiết</td>
</tr>
<tr>
<td style="text-align: left"><code>sub_return_message</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Mô tả chi tiết mã trạng thái</td>
</tr>
<tr>
<td style="text-align: left"><code>order_url</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Dùng để tạo QR code hoặc gọi chuyển tiếp sang trang cổng ZaloPay</td>
</tr>
<tr>
<td style="text-align: left"><code>zp_trans_token</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Thông tin token đơn hàng</td>
</tr>
<tr>
<td style="text-align: left"><code>order_token</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Thông tin token đơn hàng</td>
</tr>
<tr>
<td style="text-align: left"><code>qr_code</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Dùng để tạo NAPAS VietQR trên hệ thống Merchant. NAPAS VietQR là một trong những giải pháp thanh toán hoàn toàn mới, chấp nhận thanh toán được thực hiện bởi cả ZaloPay &amp; +40 ngân hàng thuộc hệ thống NAPAS. Người dùng có thể sử dụng ứng dụng ngân hàng quét NAPAS VietQR để thanh toán</td>
</tr>
</tbody></table>

<p><strong>Ví dụ:</strong></p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"return_code"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"return_message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Giao dịch thành công"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"sub_return_code"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"sub_return_message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Giao dịch thành công"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"zp_trans_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACSMARlbXkIzcSCNHDWC_5jA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"order_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://qcgateway.zalopay.vn/openinapp?order=eyJ6cHRyYW5zdG9rZW4iOiJBQ1NNQVJsYlhrSXpjU0NOSERXQ181akEiLCJhcHBpZCI6MTI0NzA1fQ=="</span><span class="p">,</span><span class="w">
  </span><span class="s2">"order_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACSMARlbXkIzcSCNHDWC_5jA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"qr_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00020101021226520010vn.zalopay0203001010627000503173307089089161731338580010A000000727012800069704540114998002401295460208QRIBFTTA5204739953037045405690005802VN62210817330708908916173136304409F"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 class='anchor-head' id='tao-don-hang_code-mau'>Code mẫu</h2>
<div class="zlp-lang-selector"></div>
<pre class="highlight csharp tab-csharp"><code><span class="cm">/**
 * .Net core 2.1.505
 */</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ZaloPay.Helper</span><span class="p">;</span> <span class="c1">// HmacHelper, RSAHelper, HttpHelper, Utils (tải về ở mục DOWNLOADS)</span>
<span class="k">using</span> <span class="nn">ZaloPay.Helper.Crypto</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span> <span class="c1">// https://www.newtonsoft.com/json</span>

<span class="k">namespace</span> <span class="nn">ZaloPayExample</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">app_id</span> <span class="p">=</span> <span class="s">"2553"</span><span class="p">;</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">key1</span> <span class="p">=</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">;</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">create_order_url</span> <span class="p">=</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/create"</span><span class="p">;</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

            <span class="n">Random</span> <span class="n">rnd</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">embed_data</span> <span class="p">=</span> <span class="k">new</span> <span class="p">{</span> <span class="p">};</span>
            <span class="kt">var</span> <span class="n">items</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]{</span><span class="k">new</span><span class="p">{}};</span>
            <span class="kt">var</span> <span class="n">param</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
            <span class="kt">var</span> <span class="n">app_trans_id</span>   <span class="p">=</span> <span class="n">rnd</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">1000000</span><span class="p">);</span> <span class="c1">// Generate a random order's ID.</span>
            <span class="kt">var</span> <span class="n">param</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>    

            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"app_id"</span><span class="p">,</span> <span class="n">app_id</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"app_user"</span><span class="p">,</span> <span class="s">"user123"</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"app_time"</span><span class="p">,</span> <span class="n">Utils</span><span class="p">.</span><span class="nf">GetTimeStamp</span><span class="p">().</span><span class="nf">ToString</span><span class="p">());</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"amount"</span><span class="p">,</span> <span class="s">"50000"</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"app_trans_id"</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"yyMMdd"</span><span class="p">)</span> <span class="p">+</span> <span class="s">"_"</span> <span class="p">+</span> <span class="n">app_trans_id</span><span class="p">);</span> <span class="c1">// mã giao dich có định dạng yyMMdd_xxxx</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"embed_data"</span><span class="p">,</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">embed_data</span><span class="p">));</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"item"</span><span class="p">,</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="nf">SerializeObject</span><span class="p">(</span><span class="n">items</span><span class="p">));</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"description"</span><span class="p">,</span> <span class="s">"Lazada - Thanh toán đơn hàng #"</span><span class="p">+</span><span class="n">app_trans_id</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"bank_code"</span><span class="p">,</span> <span class="s">"zalopayapp"</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="n">app_id</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"app_trans_id"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"app_user"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"amount"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"|"</span> 
                <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"app_time"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"embed_data"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"item"</span><span class="p">];</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"mac"</span><span class="p">,</span> <span class="n">HmacHelper</span><span class="p">.</span><span class="nf">Compute</span><span class="p">(</span><span class="n">ZaloPayHMAC</span><span class="p">.</span><span class="n">HMACSHA256</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">data</span><span class="p">));</span>

            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">HttpHelper</span><span class="p">.</span><span class="nf">PostFormAsync</span><span class="p">(</span><span class="n">create_order_url</span><span class="p">,</span> <span class="n">param</span><span class="p">);</span>

            <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"{0} = {1}"</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// Java version "1.8.0_201"</span>
<span class="kn">import</span> <span class="nn">org.apache.http.NameValuePair</span><span class="o">;</span> <span class="c1">// https://mvnrepository.com/artifact/org.apache.httpcomponents/httpclient</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.entity.UrlEncodedFormEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.CloseableHttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.message.BasicNameValuePair</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.json.JSONObject</span><span class="o">;</span> <span class="c1">// https://mvnrepository.com/artifact/org.json/json</span>
<span class="kn">import</span> <span class="nn">vn.zalopay.crypto.HMACUtil</span><span class="o">;</span> <span class="c1">// tải về ở mục DOWNLOADS</span>

<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CreateOrder</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(){{</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">,</span> <span class="s">"2553"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"key1"</span><span class="o">,</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"key2"</span><span class="o">,</span> <span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"endpoint"</span><span class="o">,</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/create"</span><span class="o">);</span>
    <span class="o">}};</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getCurrentTimeString</span><span class="o">(</span><span class="n">String</span> <span class="n">format</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Calendar</span> <span class="n">cal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GregorianCalendar</span><span class="o">(</span><span class="n">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"GMT+7"</span><span class="o">));</span>
        <span class="n">SimpleDateFormat</span> <span class="n">fmt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="n">format</span><span class="o">);</span>
        <span class="n">fmt</span><span class="o">.</span><span class="na">setCalendar</span><span class="o">(</span><span class="n">cal</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">cal</span><span class="o">.</span><span class="na">getTimeInMillis</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span> <span class="n">String</span><span class="o">[]</span> <span class="n">args</span> <span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
    <span class="o">{</span>
        <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">random_id</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">1000000</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">Map</span> <span class="n">embed_data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">(){{}};</span>

        <span class="kd">final</span> <span class="n">Map</span><span class="o">[]</span> <span class="n">item</span> <span class="o">=</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">HashMap</span><span class="o">(){{}}</span>
        <span class="o">};</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">order</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;(){{</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">,</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">));</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"app_trans_id"</span><span class="o">,</span> <span class="n">getCurrentTimeString</span><span class="o">(</span><span class="s">"yyMMdd"</span><span class="o">)</span> <span class="o">+</span><span class="s">"_"</span><span class="o">+</span> <span class="n">random_id</span><span class="o">;</span> <span class="c1">// translation missing: vi.docs.shared.sample_code.comments.app_trans_id</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"app_time"</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span> <span class="c1">// miliseconds</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"app_user"</span><span class="o">,</span> <span class="s">"user123"</span><span class="o">);</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"amount"</span><span class="o">,</span> <span class="mi">50000</span><span class="o">);</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"description"</span><span class="o">,</span> <span class="s">"Lazada - Payment for the order #"</span><span class="o">+</span><span class="n">random_id</span><span class="o">);</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"bank_code"</span><span class="o">,</span> <span class="s">"zalopayapp"</span><span class="o">);</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"item"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">item</span><span class="o">).</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"embed_data"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">embed_data</span><span class="o">).</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}};</span>

        <span class="c1">// app_id +”|”+ app_trans_id +”|”+ appuser +”|”+ amount +"|" + app_time +”|”+ embed_data +"|" +item</span>
        <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">)</span> <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"app_trans_id"</span><span class="o">)</span> <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"app_user"</span><span class="o">)</span> <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"amount"</span><span class="o">)</span>
                <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"app_time"</span><span class="o">)</span> <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"embed_data"</span><span class="o">)</span> <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"item"</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"mac"</span><span class="o">,</span> <span class="n">HMACUtil</span><span class="o">.</span><span class="na">HMacHexStringEncode</span><span class="o">(</span><span class="n">HMACUtil</span><span class="o">.</span><span class="na">HMACSHA256</span><span class="o">,</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"key1"</span><span class="o">),</span> <span class="n">data</span><span class="o">));</span>

        <span class="n">CloseableHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
        <span class="n">HttpPost</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"endpoint"</span><span class="o">));</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">NameValuePair</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">:</span> <span class="n">order</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicNameValuePair</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">toString</span><span class="o">()));</span>
        <span class="o">}</span>

        <span class="c1">// Content-Type: application/x-www-form-urlencoded</span>
        <span class="n">post</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="k">new</span> <span class="n">UrlEncodedFormEntity</span><span class="o">(</span><span class="n">params</span><span class="o">));</span>

        <span class="n">CloseableHttpResponse</span> <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
        <span class="n">BufferedReader</span> <span class="n">rd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="na">getEntity</span><span class="o">().</span><span class="na">getContent</span><span class="o">()));</span>
        <span class="n">StringBuilder</span> <span class="n">resultJsonStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">line</span><span class="o">;</span>

        <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">resultJsonStr</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">JSONObject</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">resultJsonStr</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">key</span> <span class="o">:</span> <span class="n">result</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%s = %s\n"</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight go tab-go"><code><span class="c">// go version go1.11.1 linux/amd64</span><span class="x">
</span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
    </span><span class="s">"encoding/json"</span><span class="x">
    </span><span class="s">"fmt"</span><span class="x">
    </span><span class="s">"io/ioutil"</span><span class="x">
    </span><span class="s">"log"</span><span class="x">
    </span><span class="s">"net/http"</span><span class="x">
    </span><span class="s">"net/url"</span><span class="x">
    </span><span class="s">"strconv"</span><span class="x">
    </span><span class="s">"time"</span><span class="x">
    </span><span class="s">"math/rand"</span><span class="x">

    </span><span class="s">"github.com/zpmep/hmacutil"</span><span class="x"> </span><span class="c">// go get github.com/zpmep/hmacutil</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">type</span><span class="x"> </span><span class="n">object</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}</span><span class="x">

</span><span class="k">var</span><span class="x"> </span><span class="p">(</span><span class="x">
    </span><span class="n">app_id</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"2553"</span><span class="x">
    </span><span class="n">key1</span><span class="x">  </span><span class="o">=</span><span class="x"> </span><span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="x">
    </span><span class="n">key2</span><span class="x">  </span><span class="o">=</span><span class="x"> </span><span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="n">rand</span><span class="o">.</span><span class="n">Seed</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">UnixNano</span><span class="p">())</span><span class="x">
    </span><span class="n">transID</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="m">1000000</span><span class="p">)</span><span class="x"> </span><span class="c">// Generate random trans id</span><span class="x">
    </span><span class="n">embedData</span><span class="p">,</span><span class="x"> </span><span class="n">_</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">object</span><span class="p">{})</span><span class="x">
    </span><span class="n">items</span><span class="p">,</span><span class="x"> </span><span class="n">_</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">([]</span><span class="n">object</span><span class="p">{})</span><span class="x">
    </span><span class="c">// request data</span><span class="x">
    </span><span class="n">params</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="nb">make</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">Values</span><span class="p">)</span><span class="x">
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"app_id"</span><span class="p">,</span><span class="x"> </span><span class="n">app_id</span><span class="p">)</span><span class="x">                            
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"amount"</span><span class="p">,</span><span class="x"> </span><span class="s">"1000"</span><span class="p">)</span><span class="x">                          
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"app_user"</span><span class="p">,</span><span class="x"> </span><span class="s">"user123"</span><span class="p">)</span><span class="x">                         
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"embed_data"</span><span class="p">,</span><span class="x"> </span><span class="kt">string</span><span class="p">(</span><span class="n">embedData</span><span class="p">))</span><span class="x">            
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"item"</span><span class="p">,</span><span class="x"> </span><span class="kt">string</span><span class="p">(</span><span class="n">items</span><span class="p">))</span><span class="x">                     
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"description"</span><span class="p">,</span><span class="x"> </span><span class="s">"Lazada - Payment for the order #"</span><span class="o">+</span><span class="n">strconv</span><span class="o">.</span><span class="n">Itoa</span><span class="p">(</span><span class="n">transID</span><span class="p">))</span><span class="x">
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"bank_code"</span><span class="p">,</span><span class="x"> </span><span class="s">"zalopayapp"</span><span class="p">)</span><span class="x">                  

    </span><span class="n">now</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="x">
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"app_time"</span><span class="p">,</span><span class="x"> </span><span class="n">strconv</span><span class="o">.</span><span class="n">FormatInt</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">UnixNano</span><span class="p">()</span><span class="o">/</span><span class="kt">int64</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span><span class="p">),</span><span class="x"> </span><span class="m">10</span><span class="p">))</span><span class="x"> </span><span class="c">// miliseconds</span><span class="x">

    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"app_trans_id"</span><span class="p">,</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%02d%02d%02d_%v"</span><span class="p">,</span><span class="x"> </span><span class="n">now</span><span class="o">.</span><span class="n">Year</span><span class="p">()</span><span class="o">%</span><span class="m">100</span><span class="p">,</span><span class="x"> </span><span class="kt">int</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">Month</span><span class="p">()),</span><span class="x"> </span><span class="n">now</span><span class="o">.</span><span class="n">Day</span><span class="p">(),</span><span class="x"> </span><span class="n">transID</span><span class="p">))</span><span class="x"> </span><span class="c">// translation missing: vi.docs.shared.sample_code.comments.app_trans_id</span><span class="x">

    </span><span class="c">// appid|app_trans_id|appuser|amount|apptime|embeddata|item</span><span class="x">
    </span><span class="n">data</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%v|%v|%v|%v|%v|%v|%v"</span><span class="p">,</span><span class="x"> </span><span class="n">params</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"app_id"</span><span class="p">),</span><span class="x"> </span><span class="n">params</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"app_trans_id"</span><span class="p">),</span><span class="x"> </span><span class="n">params</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"app_user"</span><span class="p">),</span><span class="x">
        </span><span class="n">params</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"amount"</span><span class="p">),</span><span class="x"> </span><span class="n">params</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"app_time"</span><span class="p">),</span><span class="x"> </span><span class="n">params</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"embed_data"</span><span class="p">),</span><span class="x"> </span><span class="n">params</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"item"</span><span class="p">))</span><span class="x">
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"mac"</span><span class="p">,</span><span class="x"> </span><span class="n">hmacutil</span><span class="o">.</span><span class="n">HexStringEncode</span><span class="p">(</span><span class="n">hmacutil</span><span class="o">.</span><span class="n">SHA256</span><span class="p">,</span><span class="x"> </span><span class="n">key1</span><span class="p">,</span><span class="x"> </span><span class="n">data</span><span class="p">))</span><span class="x">

    </span><span class="c">// Content-Type: application/x-www-form-urlencoded</span><span class="x">
    </span><span class="n">res</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">PostForm</span><span class="p">(</span><span class="s">"https://sb-openapi.zalopay.vn/v2/create"</span><span class="p">,</span><span class="x"> </span><span class="n">params</span><span class="p">)</span><span class="x">

    </span><span class="c">// parse response</span><span class="x">
    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
    </span><span class="k">defer</span><span class="x"> </span><span class="n">res</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span><span class="x">

    </span><span class="n">body</span><span class="p">,</span><span class="x"> </span><span class="n">_</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">ioutil</span><span class="o">.</span><span class="n">ReadAll</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span><span class="x">

    </span><span class="k">var</span><span class="x"> </span><span class="n">result</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}</span><span class="x">

    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">(</span><span class="n">body</span><span class="p">,</span><span class="x"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">);</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">

    </span><span class="k">for</span><span class="x"> </span><span class="n">k</span><span class="p">,</span><span class="x"> </span><span class="n">v</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">result</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%s = %+v"</span><span class="p">,</span><span class="x"> </span><span class="n">k</span><span class="p">,</span><span class="x"> </span><span class="n">v</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// Node v10.15.3</span>
<span class="kr">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'axios'</span><span class="p">).</span><span class="k">default</span><span class="p">;</span> <span class="c1">// npm install axios</span>
<span class="kr">const</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'crypto-js'</span><span class="p">);</span> <span class="c1">// npm install crypto-js</span>
<span class="kr">const</span> <span class="nx">moment</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'moment'</span><span class="p">);</span> <span class="c1">// npm install moment</span>

<span class="c1">// APP INFO</span>
<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">app_id</span><span class="p">:</span> <span class="s2">"2553"</span><span class="p">,</span>
    <span class="na">key1</span><span class="p">:</span> <span class="s2">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
    <span class="na">key2</span><span class="p">:</span> <span class="s2">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
    <span class="na">endpoint</span><span class="p">:</span> <span class="s2">"https://sb-openapi.zalopay.vn/v2/create"</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">embed_data</span> <span class="o">=</span> <span class="p">{};</span>

<span class="kr">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="p">[{}];</span>
<span class="kr">const</span> <span class="nx">transID</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">order</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">app_id</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">app_id</span><span class="p">,</span>
    <span class="na">app_trans_id</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">moment</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="s1">'YYMMDD'</span><span class="p">)}</span><span class="s2">_</span><span class="p">${</span><span class="nx">transID</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="c1">// translation missing: vi.docs.shared.sample_code.comments.app_trans_id</span>
    <span class="na">app_user</span><span class="p">:</span> <span class="s2">"user123"</span><span class="p">,</span>
    <span class="na">app_time</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span> <span class="c1">// miliseconds</span>
    <span class="na">item</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">items</span><span class="p">),</span>
    <span class="na">embed_data</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">embed_data</span><span class="p">),</span>
    <span class="na">amount</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="s2">`Lazada - Payment for the order #</span><span class="p">${</span><span class="nx">transID</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
    <span class="na">bank_code</span><span class="p">:</span> <span class="s2">"zalopayapp"</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// appid|app_trans_id|appuser|amount|apptime|embeddata|item</span>
<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">app_id</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">order</span><span class="p">.</span><span class="nx">app_trans_id</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">order</span><span class="p">.</span><span class="nx">app_user</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">order</span><span class="p">.</span><span class="nx">amount</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">order</span><span class="p">.</span><span class="nx">app_time</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">order</span><span class="p">.</span><span class="nx">embed_data</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">order</span><span class="p">.</span><span class="nx">item</span><span class="p">;</span>
<span class="nx">order</span><span class="p">.</span><span class="nx">mac</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">key1</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>

<span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span> <span class="na">params</span><span class="p">:</span> <span class="nx">order</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
<span class="c1">// PHP Version 7.3.3
</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"app_id"</span> <span class="o">=&gt;</span> <span class="mi">2553</span><span class="p">,</span>
    <span class="s2">"key1"</span> <span class="o">=&gt;</span> <span class="s2">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
    <span class="s2">"key2"</span> <span class="o">=&gt;</span> <span class="s2">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
    <span class="s2">"endpoint"</span> <span class="o">=&gt;</span> <span class="s2">"https://sb-openapi.zalopay.vn/v2/create"</span>
<span class="p">];</span>

<span class="nv">$embeddata</span> <span class="o">=</span> <span class="s1">'{}'</span><span class="p">;</span> <span class="c1">// Merchant's data
</span><span class="nv">$items</span> <span class="o">=</span> <span class="s1">'[]'</span><span class="p">;</span> <span class="c1">// Merchant's data
</span><span class="nv">$transID</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000000</span><span class="p">);</span> <span class="c1">//Random trans id
</span><span class="nv">$order</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"app_id"</span> <span class="o">=&gt;</span> <span class="nv">$config</span><span class="p">[</span><span class="s2">"app_id"</span><span class="p">],</span>
    <span class="s2">"app_time"</span> <span class="o">=&gt;</span> <span class="nb">round</span><span class="p">(</span><span class="nb">microtime</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span> <span class="c1">// miliseconds
</span>    <span class="s2">"app_trans_id"</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s2">"ymd"</span><span class="p">)</span> <span class="o">.</span> <span class="s2">"_"</span> <span class="o">.</span> <span class="nv">$transID</span><span class="p">,</span> <span class="c1">// translation missing: vi.docs.shared.sample_code.comments.app_trans_id
</span>    <span class="s2">"app_user"</span> <span class="o">=&gt;</span> <span class="s2">"user123"</span><span class="p">,</span>
    <span class="s2">"item"</span> <span class="o">=&gt;</span> <span class="nv">$items</span><span class="p">,</span>
    <span class="s2">"embed_data"</span> <span class="o">=&gt;</span> <span class="nv">$embeddata</span><span class="p">,</span>
    <span class="s2">"amount"</span> <span class="o">=&gt;</span> <span class="mi">50000</span><span class="p">,</span>
    <span class="s2">"description"</span> <span class="o">=&gt;</span> <span class="s2">"Lazada - Payment for the order #</span><span class="nv">$transID</span><span class="s2">"</span><span class="p">,</span>
    <span class="s2">"bank_code"</span> <span class="o">=&gt;</span> <span class="s2">"zalopayapp"</span>
<span class="p">];</span>

<span class="c1">// appid|app_trans_id|appuser|amount|apptime|embeddata|item
</span><span class="nv">$data</span> <span class="o">=</span> <span class="nv">$order</span><span class="p">[</span><span class="s2">"app_id"</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"|"</span> <span class="o">.</span> <span class="nv">$order</span><span class="p">[</span><span class="s2">"app_trans_id"</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"|"</span> <span class="o">.</span> <span class="nv">$order</span><span class="p">[</span><span class="s2">"app_user"</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"|"</span> <span class="o">.</span> <span class="nv">$order</span><span class="p">[</span><span class="s2">"amount"</span><span class="p">]</span>
    <span class="o">.</span> <span class="s2">"|"</span> <span class="o">.</span> <span class="nv">$order</span><span class="p">[</span><span class="s2">"app_time"</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"|"</span> <span class="o">.</span> <span class="nv">$order</span><span class="p">[</span><span class="s2">"embed_data"</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"|"</span> <span class="o">.</span> <span class="nv">$order</span><span class="p">[</span><span class="s2">"item"</span><span class="p">];</span>
<span class="nv">$order</span><span class="p">[</span><span class="s2">"mac"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s2">"sha256"</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s2">"key1"</span><span class="p">]);</span>

<span class="nv">$context</span> <span class="o">=</span> <span class="nb">stream_context_create</span><span class="p">([</span>
    <span class="s2">"http"</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s2">"header"</span> <span class="o">=&gt;</span> <span class="s2">"Content-type: application/x-www-form-urlencoded</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">,</span>
        <span class="s2">"method"</span> <span class="o">=&gt;</span> <span class="s2">"POST"</span><span class="p">,</span>
        <span class="s2">"content"</span> <span class="o">=&gt;</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">]);</span>

<span class="nv">$resp</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s2">"endpoint"</span><span class="p">],</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">$context</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$resp</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"</span><span class="nv">$key</span><span class="s2">: </span><span class="nv">$value</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code><span class="c1"># ruby 2.5.1p57</span>

<span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span> <span class="c1"># gem install openssl</span>
<span class="nb">require</span> <span class="s1">'net/http'</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">app_id: </span><span class="s1">'2553'</span><span class="p">,</span>
  <span class="ss">key1: </span><span class="s1">'PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL'</span><span class="p">,</span>
  <span class="ss">key2: </span><span class="s1">'kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz'</span><span class="p">,</span>
  <span class="ss">endpoint: </span><span class="s1">'https://sb-openapi.zalopay.vn/v2/create'</span>
<span class="p">}</span>

<span class="n">trans_id</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">1000000</span><span class="p">).</span><span class="nf">to_s</span> <span class="c1">#Random trans id</span>
<span class="n">apptime</span> <span class="o">=</span> <span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_f</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">).</span><span class="nf">to_i</span> <span class="c1"># miliseconds</span>
<span class="n">app_trans_id</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="s1">'%y%m%d'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'_'</span> <span class="o">+</span> <span class="n">trans_id</span>

<span class="n">embeddata</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">items</span> <span class="o">=</span> <span class="p">[{}]</span>

<span class="n">order</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">app_id: </span><span class="n">config</span><span class="p">[</span><span class="ss">:app_id</span><span class="p">],</span>
  <span class="ss">app_trans_id: </span><span class="n">app_trans_id</span><span class="p">,</span> <span class="c1"># translation missing: vi.docs.shared.sample_code.comments.app_trans_id</span>
  <span class="ss">app_user: </span><span class="s1">'user123'</span><span class="p">,</span>
  <span class="ss">app_time: </span><span class="n">apptime</span><span class="p">,</span> <span class="c1"># miliseconds </span>
  <span class="ss">item: </span><span class="n">items</span><span class="p">.</span><span class="nf">to_json</span><span class="p">,</span> 
  <span class="ss">embed_data: </span><span class="n">embeddata</span><span class="p">.</span><span class="nf">to_json</span><span class="p">,</span> 
  <span class="ss">amount: </span><span class="mi">50_000</span><span class="p">,</span> 
  <span class="ss">description: </span><span class="s2">"Lazada - Payment for the order #</span><span class="si">#{</span><span class="n">trans_id</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> 
  <span class="ss">bank_code: </span><span class="s1">'zalopayapp'</span>
<span class="p">}</span>

<span class="c1"># appid|app_trans_id|appuser|amount|app_time|embed_data|item</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="ss">:app_id</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">app_trans_id</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">order</span><span class="p">[</span><span class="ss">:app_user</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">order</span><span class="p">[</span><span class="ss">:amount</span><span class="p">].</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span>
       <span class="n">order</span><span class="p">[</span><span class="ss">:app_time</span><span class="p">].</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">order</span><span class="p">[</span><span class="ss">:embed_data</span><span class="p">].</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">order</span><span class="p">[</span><span class="ss">:item</span><span class="p">].</span><span class="nf">to_s</span>

<span class="n">order</span><span class="p">[</span><span class="ss">:mac</span><span class="p">]</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="ss">:key1</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">post_form</span><span class="p">(</span><span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="ss">:endpoint</span><span class="p">]),</span> <span class="n">order</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>

<span class="n">result</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre><pre class="highlight python tab-python"><code><span class="c"># coding=utf-8</span>
<span class="c"># Python 3.6</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">json</span><span class="p">,</span> <span class="n">hmac</span><span class="p">,</span> <span class="n">hashlib</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span> <span class="n">random</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"app_id"</span><span class="p">:</span> <span class="mi">2553</span><span class="p">,</span>
  <span class="s">"key1"</span><span class="p">:</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
  <span class="s">"key2"</span><span class="p">:</span> <span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
  <span class="s">"endpoint"</span><span class="p">:</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/create"</span>
<span class="p">}</span>
<span class="n">transID</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1000000</span><span class="p">))</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"app_id"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"app_id"</span><span class="p">],</span>
  <span class="s">"app_trans_id"</span><span class="p">:</span> <span class="s">"{:</span><span class="si">%</span><span class="s">y</span><span class="si">%</span><span class="s">m</span><span class="si">%</span><span class="s">d}_{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">transID</span><span class="p">),</span> <span class="c"># mã giao dich có định dạng yyMMdd_xxxx</span>
  <span class="s">"app_user"</span><span class="p">:</span> <span class="s">"user123"</span><span class="p">,</span>
  <span class="s">"app_time"</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)),</span> <span class="c"># miliseconds</span>
  <span class="s">"embed_data"</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({}),</span>
  <span class="s">"item"</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([{}]),</span>
  <span class="s">"amount"</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
  <span class="s">"description"</span><span class="p">:</span> <span class="s">"Lazada - Payment for the order #"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">transID</span><span class="p">),</span>
  <span class="s">"bank_code"</span><span class="p">:</span> <span class="s">"zalopayapp"</span>
<span class="p">}</span>

<span class="c"># app_id|app_trans_id|app_user|amount|apptime|embed_data|item</span>
<span class="n">data</span> <span class="o">=</span> <span class="s">"{}|{}|{}|{}|{}|{}|{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">order</span><span class="p">[</span><span class="s">"app_id"</span><span class="p">],</span> <span class="n">order</span><span class="p">[</span><span class="s">"app_trans_id"</span><span class="p">],</span> <span class="n">order</span><span class="p">[</span><span class="s">"app_user"</span><span class="p">],</span> 
<span class="n">order</span><span class="p">[</span><span class="s">"amount"</span><span class="p">],</span> <span class="n">order</span><span class="p">[</span><span class="s">"app_time"</span><span class="p">],</span> <span class="n">order</span><span class="p">[</span><span class="s">"embed_data"</span><span class="p">],</span> <span class="n">order</span><span class="p">[</span><span class="s">"item"</span><span class="p">])</span>

<span class="n">order</span><span class="p">[</span><span class="s">"mac"</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">'key1'</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"endpoint"</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"{}: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
</code></pre><pre class="highlight shell"><code>curl -X POST https://sb-openapi.zalopay.vn/v2/create <span class="se">\</span>
  -H <span class="s2">"Content-type: application/x-www-form-urlencoded"</span> <span class="se">\</span>
  -d <span class="nv">app_id</span><span class="o">=</span>2553 <span class="se">\</span>
  -d <span class="nv">app_trans_id</span><span class="o">=</span>200904_432565 <span class="se">\</span>
  -d <span class="nv">app_user</span><span class="o">=</span><span class="s1">'user123'</span> <span class="se">\</span>
  -d <span class="nv">app_time</span><span class="o">=</span>1599209942052 <span class="se">\</span>
  -d <span class="nv">item</span><span class="o">=</span><span class="s1">'[{}]'</span> <span class="se">\</span>
  -d <span class="nv">embed_data</span><span class="o">=</span><span class="s1">'{}'</span> <span class="se">\</span>
  -d <span class="nv">amount</span><span class="o">=</span>50000 <span class="se">\</span>
  -d <span class="nv">description</span><span class="o">=</span><span class="s1">'Lazada - Payment for the order #432565'</span> <span class="se">\</span>
  -d <span class="nv">bank_code</span><span class="o">=</span>zalopayapp <span class="se">\</span>
  -d <span class="nv">mac</span><span class="o">=</span>a921656413d6ef62d8d7fdab012f69be45335ebb158aeb483897b1b60acc80c2
</code></pre>
<aside class="alert alert-primary">
<a href="/downloads/">Tải về các thư viện hỗ trợ tại đây</a>
</aside>

<p><span  style="font-weight: 600">
<b>Chú ý:</b> <br/>
Thông tin đơn hàng trùng lắp
</span></p>

<p><span style="color: #3288e5; ">
Khi merchant sử dụng API tạo đơn hàng để gửi thông tin một đơn hàng qua hệ thống ZaloPay, giá trị tham số app_trans_id phải là unique. Nếu giá trị app_trans_id bị trùng lắp, ZaloPay sẽ trả về sub_return_code=-68.
</span></p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"return_code"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"return_message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Giao dịch thất bại"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"sub_return_code"</span><span class="p">:</span><span class="w"> </span><span class="mi">-68</span><span class="p">,</span><span class="w">
    </span><span class="s2">"sub_return_message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mã giao dịch bị trùng"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"zp_trans_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="s2">"order_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="s2">"order_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h1 class='anchor-head' id='callback'>Callback</h1>
<p>API đối tác xây dựng sẽ nhận kết quả thanh toán từ ZaloPay. Khi và chỉ khi ZaloPay đã thu tiền khách hàng thành công thì mới gọi API này để thông báo kết quả.</p>
<h2 class='anchor-head' id='callback_luong-xu-ly'>Luồng xử lý</h2>
<p><img src="../../images/v2/callback-v2.png" alt="Callback Flow" /></p>
<h2 class='anchor-head' id='callback_dac-ta-api'>Đặc tả API</h2>
<p>Nếu trừ tiền user thành công ZaloPay Server callback cho Merchant Server theo <code>CallbackURL</code> đã cấu hình hoặc từ param <code>callback_url</code>. Merchant dùng <code>key2</code> (được cấp lúc đăng ký ứng dụng) để xác thực data do ZaloPay Server POST qua.</p>

<ul>
<li><strong>Method</strong>: <span class="code bg-primary mr-1">POST</span> </li>
<li><strong>Content-Type</strong>: <code>application/json</code></li>
</ul>
<h3 class='anchor-head' id='callback_dac-ta-api_du-lieu-nhan-duoc-tu-callback'>Dữ liệu nhận được từ callback:</h3>
<table><thead>
<tr>
<th style="text-align: left">Tên</th>
<th style="text-align: left">Kiểu dữ liệu</th>
<th style="text-align: left">Mô tả</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>data</code></td>
<td style="text-align: left">Json String</td>
<td style="text-align: left">Dữ liệu giao dịch ZaloPay gọi về cho ứng dụng</td>
</tr>
<tr>
<td style="text-align: left"><code>mac</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Thông tin chứng thực của đơn hàng, dùng Callback Key (Key2) được cung cấp để chứng thực đơn hàng</td>
</tr>
<tr>
<td style="text-align: left"><code>type</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left">Loại callback <p><code>1</code>: Order</p> <p><code>2</code>: Agreement</p></td>
</tr>
</tbody></table>

<p><strong>Dữ liệu của trường data:</strong></p>

<table><thead>
<tr>
<th style="text-align: left"><div style="width:160px">Tên</div></th>
<th style="text-align: left">Kiểu dữ liệu</th>
<th style="text-align: left">Mô tả</th>
<th style="text-align: left">Ví dụ</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>app_id</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left"><code>app_id</code> của đơn hàng</td>
<td style="text-align: left"><code>5</code></td>
</tr>
<tr>
<td style="text-align: left"><code>app_trans_id</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left"><code>app_trans_id</code> của đơn hàng</td>
<td style="text-align: left"><code>180208181007242</code></td>
</tr>
<tr>
<td style="text-align: left"><code>app_time</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left"><code>app_time</code> của đơn hàng</td>
<td style="text-align: left"><code>1460543835849</code></td>
</tr>
<tr>
<td style="text-align: left"><code>app_user</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left"><code>app_user</code> của đơn hàng</td>
<td style="text-align: left"><code>pmqc</code></td>
</tr>
<tr>
<td style="text-align: left"><code>amount</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left">Số tiền ứng dụng nhận được</td>
<td style="text-align: left"><code>50000</code></td>
</tr>
<tr>
<td style="text-align: left"><code>embed_data</code></td>
<td style="text-align: left">JSON String</td>
<td style="text-align: left"><code>embed_data</code> của đơn hàng. <br/> &bull; Dữ liệu bắt buộc phải là <code>json string</code></td>
<td style="text-align: left"><code>{&quot;promotioninfo&quot;:&quot;&quot;,&quot;merchantinfo&quot;:&quot;du lieu rieng cua ung dung&quot;}</code> <br/><br/>Data empty: <code>{}</code></td>
</tr>
<tr>
<td style="text-align: left"><code>item</code></td>
<td style="text-align: left">JSON Array String</td>
<td style="text-align: left"><code>item</code> của đơn hàng. <br/> &bull; Dữ liệu bắt buộc phải là <code>json array string</code></td>
<td style="text-align: left"><code>[{&quot;itemid&quot;:&quot;knb&quot;,&quot;itename&quot;:&quot;kim nguyen bao&quot;,&quot;itemprice&quot;:198400,&quot;itemquantity&quot;:1}]</code> <br/><br/>Data empty: <code>[]</code></td>
</tr>
<tr>
<td style="text-align: left"><code>zp_trans_id</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left">Mã giao dịch của ZaloPay</td>
<td style="text-align: left"><code>160413000003083</code></td>
</tr>
<tr>
<td style="text-align: left"><code>server_time</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left">Thời gian giao dịch của ZaloPay (unix timestamp in miliseconds)</td>
<td style="text-align: left"><code>1460543836370</code></td>
</tr>
<tr>
<td style="text-align: left"><code>channel</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left">Kênh thanh toán</td>
<td style="text-align: left"><code>38</code></td>
</tr>
<tr>
<td style="text-align: left"><code>merchant_user_id</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">ZaloPay user đã thanh toán cho đơn hàng</td>
<td style="text-align: left"><code>7ZMSl3nEg5sOUJzOLSoUFT8xKNQVaLOLXHB--8Eytqc</code></td>
</tr>
<tr>
<td style="text-align: left"><code>user_fee_amount</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left">Số tiền phí</td>
<td style="text-align: left"><code>220</code></td>
</tr>
<tr>
<td style="text-align: left"><code>discount_amount</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left">Số tiền giảm giá</td>
<td style="text-align: left"><code>10000</code></td>
</tr>
</tbody></table>

<p><strong>Ví dụ:</strong></p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="s2">"data"</span><span class="p">:</span><span class="s2">"{</span><span class="se">\"</span><span class="s2">app_id</span><span class="se">\"</span><span class="s2">:2553,</span><span class="se">\"</span><span class="s2">app_trans_id</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">200904_2553_1598435687208</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">app_time</span><span class="se">\"</span><span class="s2">:1599189392817,</span><span class="se">\"</span><span class="s2">app_user</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">demo</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">amount</span><span class="se">\"</span><span class="s2">:10000,</span><span class="se">\"</span><span class="s2">embed_data</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">{</span><span class="se">\\\"</span><span class="s2">merchantinfo</span><span class="se">\\\"</span><span class="s2">:</span><span class="se">\\\"</span><span class="s2">embeddata123</span><span class="se">\\\"</span><span class="s2">,</span><span class="se">\\\"</span><span class="s2">promotioninfo</span><span class="se">\\\"</span><span class="s2">:</span><span class="se">\\\"\\\"</span><span class="s2">}</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">item</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">[{</span><span class="se">\\\"</span><span class="s2">itemid</span><span class="se">\\\"</span><span class="s2">:</span><span class="se">\\\"</span><span class="s2">knb</span><span class="se">\\\"</span><span class="s2">,</span><span class="se">\\\"</span><span class="s2">itemname</span><span class="se">\\\"</span><span class="s2">:</span><span class="se">\\\"</span><span class="s2">kim nguyen bao</span><span class="se">\\\"</span><span class="s2">,</span><span class="se">\\\"</span><span class="s2">itemprice</span><span class="se">\\\"</span><span class="s2">:198400,</span><span class="se">\\\"</span><span class="s2">itemquantity</span><span class="se">\\\"</span><span class="s2">:1}]</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">zp_trans_id</span><span class="se">\"</span><span class="s2">:200904000000389,</span><span class="se">\"</span><span class="s2">server_time</span><span class="se">\"</span><span class="s2">:1599189413498,</span><span class="se">\"</span><span class="s2">channel</span><span class="se">\"</span><span class="s2">:38,</span><span class="se">\"</span><span class="s2">merchant_user_id</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">7ZMSl3nEg5sOUJzOLSoUFT8xKNQVaLOLXHB--8Eytqc</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">user_fee_amount</span><span class="se">\"</span><span class="s2">:0,</span><span class="se">\"</span><span class="s2">discount_amount</span><span class="se">\"</span><span class="s2">:0}"</span><span class="p">,</span><span class="s2">"mac"</span><span class="p">:</span><span class="s2">"d8d33baf449b31d7f9b94fa50d7c942c08cd4d83f28fa185557da21acb104f67"</span><span class="p">,</span><span class="s2">"type"</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="w">
</span></code></pre><h3 class='anchor-head' id='callback_dac-ta-api_kiem-tra-callback-hop-le'>Kiểm tra callback hợp lệ</h3><pre class="highlight javascript"><code><span class="nx">reqmac</span> <span class="o">=</span> <span class="nx">HMAC</span><span class="p">(</span><span class="nx">hmac_algorithm</span><span class="p">,</span> <span class="nx">key2</span><span class="p">,</span> <span class="nx">callback_data</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">reqmac</span> <span class="o">==</span> <span class="nx">callback_data</span><span class="p">.</span><span class="nx">mac</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// callback hợp lệ</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// callback không hợp lệ</span>
<span class="p">}</span> 
</code></pre>
<p><strong>Trong đó:</strong></p>

<ul>
<li><strong>hmac_algorithm</strong>: Là phương thức bảo mật do ứng dụng đăng ký với ZaloPay, mặc định là <code>HmacSHA256</code></li>
<li><strong>key2</strong>: Là Mac Key do ZaloPay cung cấp cho ứng dụng lúc đăng ký ứng dụng</li>
<li><strong>callback_data</strong>: Là dữ liệu do ZaloPay request tới callback API của Merchant khi ZaloPay đã thu tiền khách hàng thành công.</li>
</ul>
<h3 class='anchor-head' id='callback_dac-ta-api_cac-kenh-thanh-toan-ho-tro'>Các kênh thanh toán hỗ trợ:</h3>
<table><thead>
<tr>
<th style="text-align: left">Giá trị</th>
<th style="text-align: left">Kênh thanh toán</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>36</code></td>
<td style="text-align: left">Visa/Master/JCB</td>
</tr>
<tr>
<td style="text-align: left"><code>37</code></td>
<td style="text-align: left">Bank Account</td>
</tr>
<tr>
<td style="text-align: left"><code>38</code></td>
<td style="text-align: left">ZaloPay Wallet</td>
</tr>
<tr>
<td style="text-align: left"><code>39</code></td>
<td style="text-align: left">ATM</td>
</tr>
<tr>
<td style="text-align: left"><code>41</code></td>
<td style="text-align: left">Visa/Master Debit</td>
</tr>
</tbody></table>
<h3 class='anchor-head' id='callback_dac-ta-api_thong-tin-appserver-tra-ve-cho-zalopayserver-khi-nhan-callback'>Thông tin AppServer trả về cho ZaloPayServer khi nhận callback</h3>
<ul>
<li><strong>Content-Type</strong>: <code>application/json</code></li>
</ul>

<table><thead>
<tr>
<th style="text-align: left">Tham số</th>
<th style="text-align: left">Kiểu dữ liệu</th>
<th style="text-align: left">Ý nghĩa</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>return_code</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left"><p><code>1</code>: thành công</p><p><code>2</code>: trùng mã giao dịch ZaloPay zptransid hoặc app_trans_id ( đã cung cấp dịch vụ cho user trước đó)</p><p><code>&lt;&gt;</code>: thất bại (không callback lại)</p></td>
</tr>
<tr>
<td style="text-align: left"><code>return_message</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Mô tả chi tiết mã trạng thái</td>
</tr>
</tbody></table>

<p><strong>Ví dụ:</strong></p>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"return_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[return_code]"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"return_message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[return_message]"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<aside class="alert alert-primary">
  <strong>Lưu ý</strong>
  <p class="mt-2">Sau <strong>15 phút</strong> tính từ lúc tạo đơn hàng, nếu không nhận được callback từ phía ZaloPay thì Merchant cần chủ động gọi API <a href="javascript:scrollToElement('#truy-van-trang-thai-thanh-toan-cua-don-hang')">Truy vấn trạng thái thanh toán của đơn hàng</a> để lấy kết quả cuối cùng.</p>
</aside>
<h2 class='anchor-head' id='callback_code-mau'>Code mẫu</h2>
<div class="zlp-lang-selector"></div>
<pre class="highlight csharp tab-csharp"><code><span class="cm">/**
 * .Net core 2.1.505
 */</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ZaloPay.Helper</span><span class="p">;</span> <span class="c1">// HmacHelper, RSAHelper, HttpHelper, Utils (tải về ở mục DOWNLOADS)</span>
<span class="k">using</span> <span class="nn">ZaloPay.Helper.Crypto</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span> <span class="c1">// https://www.newtonsoft.com/json</span>

<span class="k">namespace</span> <span class="nn">ZaloPayExample.Controllers</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"[controller]"</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">ApiController</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">CallbackController</span><span class="p">:</span> <span class="n">ControllerBase</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="n">key2</span> <span class="p">=</span> <span class="s">"eG4r0GcoNtRGbO8"</span><span class="p">;</span>

        <span class="p">[</span><span class="n">HttpPost</span><span class="p">]</span>
        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Post</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span> <span class="kt">dynamic</span> <span class="n">cbdata</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;();</span>

            <span class="k">try</span> <span class="p">{</span>
              <span class="kt">var</span> <span class="n">dataStr</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="n">cbdata</span><span class="p">[</span><span class="s">"data"</span><span class="p">]);</span>
              <span class="kt">var</span> <span class="n">reqMac</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="n">cbdata</span><span class="p">[</span><span class="s">"mac"</span><span class="p">]);</span>

              <span class="kt">var</span> <span class="n">mac</span> <span class="p">=</span> <span class="n">HmacHelper</span><span class="p">.</span><span class="nf">Compute</span><span class="p">(</span><span class="n">ZaloPayHMAC</span><span class="p">.</span><span class="n">HMACSHA256</span><span class="p">,</span> <span class="n">key2</span><span class="p">,</span> <span class="n">dataStr</span><span class="p">);</span>

              <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"mac = {0}"</span><span class="p">,</span> <span class="n">mac</span><span class="p">);</span>

              <span class="c1">// kiểm tra callback hợp lệ (đến từ ZaloPay server)</span>
              <span class="k">if</span> <span class="p">(!</span><span class="n">reqMac</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">mac</span><span class="p">))</span> <span class="p">{</span>
                  <span class="c1">// callback không hợp lệ</span>
                  <span class="n">result</span><span class="p">[</span><span class="s">"return_code"</span><span class="p">]</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                  <span class="n">result</span><span class="p">[</span><span class="s">"return_message"</span><span class="p">]</span> <span class="p">=</span> <span class="s">"mac not equal"</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="k">else</span> <span class="p">{</span>
                  <span class="c1">// thanh toán thành công</span>
                  <span class="c1">// merchant cập nhật trạng thái cho đơn hàng</span>
                  <span class="kt">var</span> <span class="n">dataJson</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">DeserializeObject</span><span class="p">&lt;</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;&gt;(</span><span class="n">dataStr</span><span class="p">);</span>
                  <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"update order's status = success where app_trans_id = {0}"</span><span class="p">,</span> <span class="n">dataJson</span><span class="p">[</span><span class="s">"app_trans_id"</span><span class="p">]);</span>

                  <span class="n">result</span><span class="p">[</span><span class="s">"return_code"</span><span class="p">]</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
                  <span class="n">result</span><span class="p">[</span><span class="s">"return_message"</span><span class="p">]</span> <span class="p">=</span> <span class="s">"success"</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">result</span><span class="p">[</span><span class="s">"return_code"</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// ZaloPay server sẽ callback lại (tối đa 3 lần)</span>
              <span class="n">result</span><span class="p">[</span><span class="s">"return_message"</span><span class="p">]</span> <span class="p">=</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// thông báo kết quả cho ZaloPay server</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">result</span><span class="p">);</span> 
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="cm">/**
 * Spring Boot v2.1.4.RELEASE
 * */</span>
<span class="kn">import</span> <span class="nn">org.json.JSONObject</span><span class="o">;</span> <span class="c1">// https://mvnrepository.com/artifact/org.json/json</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.crypto.Mac</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.spec.SecretKeySpec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.DatatypeConverter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CallbackController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">key2</span> <span class="o">=</span> <span class="s">"eG4r0GcoNtRGbO8"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Mac</span> <span class="n">HmacSHA256</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CallbackController</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span>  <span class="o">{</span>
        <span class="n">HmacSHA256</span> <span class="o">=</span> <span class="n">Mac</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"HmacSHA256"</span><span class="o">);</span>
        <span class="n">HmacSHA256</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="k">new</span> <span class="n">SecretKeySpec</span><span class="o">(</span><span class="n">key2</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="s">"HmacSHA256"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/callback"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">callback</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">String</span> <span class="n">jsonStr</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">JSONObject</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">{</span>
          <span class="n">JSONObject</span> <span class="n">cbdata</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">jsonStr</span><span class="o">);</span>
          <span class="n">String</span> <span class="n">dataStr</span> <span class="o">=</span> <span class="n">cbdata</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"data"</span><span class="o">);</span>
          <span class="n">String</span> <span class="n">reqMac</span> <span class="o">=</span> <span class="n">cbdata</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"mac"</span><span class="o">);</span>

          <span class="kt">byte</span><span class="o">[]</span> <span class="n">hashBytes</span> <span class="o">=</span> <span class="n">HmacSHA256</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">dataStr</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
          <span class="n">String</span> <span class="n">mac</span> <span class="o">=</span> <span class="n">DatatypeConverter</span><span class="o">.</span><span class="na">printHexBinary</span><span class="o">(</span><span class="n">hashBytes</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">();</span>

          <span class="c1">// kiểm tra callback hợp lệ (đến từ ZaloPay server)</span>
          <span class="k">if</span> <span class="o">(!</span><span class="n">reqMac</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">mac</span><span class="o">))</span> <span class="o">{</span>
              <span class="c1">// callback không hợp lệ</span>
              <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"return_code"</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
              <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"return_message"</span><span class="o">,</span> <span class="s">"mac not equal"</span><span class="o">);</span>
          <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
              <span class="c1">// thanh toán thành công</span>
              <span class="c1">// merchant cập nhật trạng thái cho đơn hàng</span>
              <span class="n">JSONObject</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">dataStr</span><span class="o">);</span>
              <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"update order's status = success where app_trans_id = "</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"app_trans_id"</span><span class="o">));</span>

              <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"return_code"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
              <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"return_message"</span><span class="o">,</span> <span class="s">"success"</span><span class="o">);</span>
          <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"return_code"</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// ZaloPay server sẽ callback lại (tối đa 3 lần)</span>
          <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"return_message"</span><span class="o">,</span> <span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="c1">// thông báo kết quả cho ZaloPay server</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight go tab-go"><code><span class="c">// go version go1.11.1 linux/amd64</span><span class="x">
</span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
    </span><span class="s">"encoding/json"</span><span class="x">
    </span><span class="s">"fmt"</span><span class="x">
    </span><span class="s">"log"</span><span class="x">
    </span><span class="s">"net/http"</span><span class="x">

    </span><span class="s">"github.com/zpmep/hmacutil"</span><span class="x"> </span><span class="c">// go get github.com/zpmep/hmacutil</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="c">// App config</span><span class="x">
</span><span class="k">var</span><span class="x"> </span><span class="p">(</span><span class="x">
    </span><span class="n">key2</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"eG4r0GcoNtRGbO8"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="n">mux</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">DefaultServeMux</span><span class="x">
    </span><span class="n">mux</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/callback"</span><span class="p">,</span><span class="x"> </span><span class="k">func</span><span class="p">(</span><span class="n">w</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span><span class="x"> </span><span class="n">r</span><span class="x"> </span><span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="k">defer</span><span class="x"> </span><span class="n">r</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span><span class="x">
        </span><span class="k">var</span><span class="x"> </span><span class="n">cbdata</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}</span><span class="x">
        </span><span class="n">decoder</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">NewDecoder</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span><span class="x">
        </span><span class="n">decoder</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cbdata</span><span class="p">)</span><span class="x">

        </span><span class="n">requestMac</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">cbdata</span><span class="p">[</span><span class="s">"mac"</span><span class="p">]</span><span class="o">.</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="x">
        </span><span class="n">dataStr</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">cbdata</span><span class="p">[</span><span class="s">"data"</span><span class="p">]</span><span class="o">.</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="x">
        </span><span class="n">mac</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">hmacutil</span><span class="o">.</span><span class="n">HexStringEncode</span><span class="p">(</span><span class="n">hmacutil</span><span class="o">.</span><span class="n">SHA256</span><span class="p">,</span><span class="x"> </span><span class="n">key2</span><span class="p">,</span><span class="x"> </span><span class="n">dataStr</span><span class="p">)</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"mac ="</span><span class="p">,</span><span class="x"> </span><span class="n">mac</span><span class="p">)</span><span class="x">

        </span><span class="n">result</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{})</span><span class="x">

    </span><span class="c">// kiểm tra callback hợp lệ (đến từ ZaloPay server)</span><span class="x">
        </span><span class="k">if</span><span class="x"> </span><span class="n">mac</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="n">requestMac</span><span class="x"> </span><span class="p">{</span><span class="x">
            </span><span class="c">// callback không hợp lệ</span><span class="x">
            </span><span class="n">result</span><span class="p">[</span><span class="s">"return_code"</span><span class="p">]</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="o">-</span><span class="m">1</span><span class="x">
            </span><span class="n">result</span><span class="p">[</span><span class="s">"return_message"</span><span class="p">]</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"mac not equal"</span><span class="x">
        </span><span class="p">}</span><span class="x"> </span><span class="k">else</span><span class="x"> </span><span class="p">{</span><span class="x">
            </span><span class="c">// thanh toán thành công</span><span class="x">
            </span><span class="n">result</span><span class="p">[</span><span class="s">"return_code"</span><span class="p">]</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="m">1</span><span class="x">
            </span><span class="n">result</span><span class="p">[</span><span class="s">"return_message"</span><span class="p">]</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"success"</span><span class="x">

            </span><span class="c">// merchant cập nhật trạng thái cho đơn hàng</span><span class="x">
            </span><span class="k">var</span><span class="x"> </span><span class="n">dataJSON</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}</span><span class="x">
            </span><span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="n">dataStr</span><span class="p">),</span><span class="x"> </span><span class="o">&amp;</span><span class="n">dataJSON</span><span class="p">)</span><span class="x">
            </span><span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"update order's status = success where app_trans_id ="</span><span class="p">,</span><span class="x"> </span><span class="n">dataJSON</span><span class="p">[</span><span class="s">"app_trans_id"</span><span class="p">])</span><span class="x">
        </span><span class="p">}</span><span class="x">

        </span><span class="c">// thông báo kết quả cho ZaloPay server</span><span class="x">
        </span><span class="n">resultJSON</span><span class="p">,</span><span class="x"> </span><span class="n">_</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="x">
        </span><span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="x"> </span><span class="s">"%s"</span><span class="p">,</span><span class="x"> </span><span class="n">resultJSON</span><span class="p">)</span><span class="x">
    </span><span class="p">})</span><span class="x">

    </span><span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Server is listening at port :8888"</span><span class="p">)</span><span class="x">
    </span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="s">":8888"</span><span class="p">,</span><span class="x"> </span><span class="n">mux</span><span class="p">)</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// Node v10.15.3</span>
<span class="kr">const</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'crypto-js'</span><span class="p">);</span> <span class="c1">// npm install crypto-js</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span> <span class="c1">// npm install express</span>
<span class="kr">const</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'body-parser'</span><span class="p">);</span> <span class="c1">// npm install body-parser</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">key2</span><span class="p">:</span> <span class="s2">"eG4r0GcoNtRGbO8"</span>
<span class="p">};</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/callback'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">dataStr</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">reqMac</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">mac</span><span class="p">;</span>

    <span class="kd">let</span> <span class="nx">mac</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">dataStr</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">key2</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"mac ="</span><span class="p">,</span> <span class="nx">mac</span><span class="p">);</span>


    <span class="c1">// kiểm tra callback hợp lệ (đến từ ZaloPay server)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">reqMac</span> <span class="o">!==</span> <span class="nx">mac</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// callback không hợp lệ</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">return_code</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">return_message</span> <span class="o">=</span> <span class="s2">"mac not equal"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// thanh toán thành công</span>
      <span class="c1">// merchant cập nhật trạng thái cho đơn hàng</span>
      <span class="kd">let</span> <span class="nx">dataJson</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">dataStr</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">key2</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"update order's status = success where app_trans_id ="</span><span class="p">,</span> <span class="nx">dataJson</span><span class="p">[</span><span class="s2">"app_trans_id"</span><span class="p">]);</span>

      <span class="nx">result</span><span class="p">.</span><span class="nx">return_code</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">return_message</span> <span class="o">=</span> <span class="s2">"success"</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">return_code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// ZaloPay server sẽ callback lại (tối đa 3 lần)</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">return_message</span> <span class="o">=</span> <span class="nx">ex</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// thông báo kết quả cho ZaloPay server</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8888</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Server is listening at port :8888'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

<span class="c1">// PHP Version 7.3.3
</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$key2</span> <span class="o">=</span> <span class="s2">"eG4r0GcoNtRGbO8"</span><span class="p">;</span>
  <span class="nv">$postdata</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">'php://input'</span><span class="p">);</span>
  <span class="nv">$postdatajson</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$postdata</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="nv">$mac</span> <span class="o">=</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s2">"sha256"</span><span class="p">,</span> <span class="nv">$postdatajson</span><span class="p">[</span><span class="s2">"data"</span><span class="p">],</span> <span class="nv">$key2</span><span class="p">);</span>

  <span class="nv">$requestmac</span> <span class="o">=</span> <span class="nv">$postdatajson</span><span class="p">[</span><span class="s2">"mac"</span><span class="p">];</span>

  <span class="c1">// kiểm tra callback hợp lệ (đến từ ZaloPay server)
</span>  <span class="k">if</span> <span class="p">(</span><span class="nb">strcmp</span><span class="p">(</span><span class="nv">$mac</span><span class="p">,</span> <span class="nv">$requestmac</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// callback không hợp lệ
</span>    <span class="nv">$result</span><span class="p">[</span><span class="s2">"return_code"</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="nv">$result</span><span class="p">[</span><span class="s2">"return_message"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"mac not equal"</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// thanh toán thành công
</span>    <span class="c1">// merchant cập nhật trạng thái cho đơn hàng
</span>    <span class="nv">$datajson</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$postdatajson</span><span class="p">[</span><span class="s2">"data"</span><span class="p">],</span> <span class="kc">true</span><span class="p">);</span>
    <span class="c1">// echo "update order's status = success where app_trans_id = ". $dataJson["app_trans_id"];
</span>
    <span class="nv">$result</span><span class="p">[</span><span class="s2">"return_code"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nv">$result</span><span class="p">[</span><span class="s2">"return_message"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"success"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$result</span><span class="p">[</span><span class="s2">"return_code"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// ZaloPay server sẽ callback lại (tối đa 3 lần)
</span>  <span class="nv">$result</span><span class="p">[</span><span class="s2">"return_message"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// thông báo kết quả cho ZaloPay server
</span><span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</code></pre><pre class="highlight ruby tab-ruby"><code><span class="c1"># ruby 2.5.1p57</span>
<span class="c1"># rails 5.2.3</span>

<span class="c1"># config/routes.rb</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">match</span> <span class="s1">'/callback'</span> <span class="o">=&gt;</span> <span class="s1">'callback#handle'</span><span class="p">,</span> <span class="ss">via: :post</span>
<span class="k">end</span>

<span class="c1"># app/controllers/callback_controller.rb</span>
<span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span> <span class="c1"># gem install openssl</span>

<span class="k">class</span> <span class="nc">CallbackController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span> 
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="k">super</span>
    <span class="vi">@config</span> <span class="o">=</span> <span class="p">{</span>
      <span class="ss">key2: </span><span class="s1">'eG4r0GcoNtRGbO8'</span>
    <span class="p">}</span>
  <span class="k">end</span>

  <span class="c1"># POST /callback</span>
  <span class="k">def</span> <span class="nf">handle</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">begin</span>
      <span class="n">cbdata</span> <span class="o">=</span> <span class="n">params</span>
      <span class="n">mac</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="vi">@config</span><span class="p">[</span><span class="ss">:key2</span><span class="p">],</span> <span class="n">cbdata</span><span class="p">[</span><span class="s1">'data'</span><span class="p">])</span>

      <span class="c1"># kiểm tra callback hợp lệ (đến từ ZaloPay server)</span>
      <span class="k">if</span> <span class="n">cbdata</span><span class="p">[</span><span class="s1">'mac'</span><span class="p">]</span> <span class="o">!=</span> <span class="n">mac</span>
        <span class="c1"># callback không hợp lệ</span>
        <span class="n">result</span><span class="p">[</span><span class="ss">:return_code</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">result</span><span class="p">[</span><span class="ss">:return_message</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"mac not equal"</span>
      <span class="k">else</span>
        <span class="c1"># thanh toán thành công</span>
        <span class="c1"># merchant cập nhật trạng thái cho đơn hàng</span>
        <span class="n">dataJson</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">cbdata</span><span class="p">[</span><span class="s1">'data'</span><span class="p">])</span>
        <span class="nb">puts</span> <span class="s2">"update order's status = success where app_trans_id = "</span> <span class="o">+</span> <span class="n">dataJson</span><span class="p">[</span><span class="s1">'app_trans_id'</span><span class="p">]</span>

        <span class="n">result</span><span class="p">[</span><span class="ss">:return_code</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">result</span><span class="p">[</span><span class="ss">:return_message</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"success"</span>
      <span class="k">end</span>
    <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">ex</span>
      <span class="n">result</span><span class="p">[</span><span class="ss">:return_code</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># ZaloPay server sẽ callback lại (tối đa 3 lần)</span>
      <span class="n">result</span><span class="p">[</span><span class="ss">:return_message</span><span class="p">]</span> <span class="o">=</span> <span class="n">ex</span><span class="p">.</span><span class="nf">message</span>
    <span class="k">end</span>

    <span class="c1"># thông báo kết quả cho ZaloPay server</span>
    <span class="n">render</span> <span class="ss">json: </span><span class="n">result</span><span class="p">,</span> <span class="ss">status: :ok</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre><pre class="highlight python tab-python"><code><span class="c"># coding=utf-8</span>
<span class="c"># Python 3.6</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">json</span> <span class="c"># pip3 install Flask </span>
<span class="kn">import</span> <span class="nn">hmac</span><span class="p">,</span> <span class="n">hashlib</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'key2'</span><span class="p">:</span> <span class="s">'eG4r0GcoNtRGbO8'</span>
<span class="p">}</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">'/callback'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">callback</span><span class="p">():</span>
  <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="k">try</span>
    <span class="n">cbdata</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>
    <span class="n">mac</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">'key2'</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">cbdata</span><span class="p">[</span><span class="s">'data'</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="c"># kiểm tra callback hợp lệ (đến từ ZaloPay server)</span>
    <span class="k">if</span> <span class="n">mac</span> <span class="o">!=</span> <span class="n">cbdata</span><span class="p">[</span><span class="s">'mac'</span><span class="p">]:</span>
      <span class="c"># callback không hợp lệ</span>
      <span class="n">result</span><span class="p">[</span><span class="s">'return_code'</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
      <span class="n">result</span><span class="p">[</span><span class="s">'return_message'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'mac not equal'</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c"># thanh toán thành công</span>
      <span class="c"># merchant cập nhật trạng thái cho đơn hàng</span>
      <span class="n">dataJson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">cbdata</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span>
      <span class="k">print</span><span class="p">(</span><span class="s">"update order's status = success where app_trans_id = "</span> <span class="o">+</span> <span class="n">dataJson</span><span class="p">[</span><span class="s">'app_trans_id'</span><span class="p">])</span>

      <span class="n">result</span><span class="p">[</span><span class="s">'return_code'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">result</span><span class="p">[</span><span class="s">'return_message'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'success'</span>
  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span>
    <span class="n">result</span><span class="p">[</span><span class="s">'return_code'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># ZaloPay server sẽ callback lại (tối đa 3 lần)</span>
    <span class="n">result</span><span class="p">[</span><span class="s">' e'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

  <span class="c"># thông báo kết quả cho ZaloPay server</span>
  <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre>
<aside class="alert alert-primary">
<a href="/downloads/">Tải về các thư viện hỗ trợ tại đây</a>
</aside>
<h1 class='anchor-head' id='truy-van-trang-thai-thanh-toan-cua-don-hang'>Truy vấn trạng thái thanh toán của đơn hàng</h1>
<p>Khi user thanh toán thành công, ZaloPay sẽ gọi callback (notify) tới merchant để merchant cập nhật trạng thái đơn hàng Thành Công trên hệ thống. Trong thực tế callback có thể bị miss do lỗi Network timeout, Merchant Service Unavailable/Internal Error... nên Merchant cần hiện thực việc chủ động gọi API truy vấn trạng thái đơn hàng.</p>

<p>Merchant Server gửi request đến ZaloPay Server để lấy thông tin trạng thái thanh toán của giao dịch.</p>

<aside class="alert alert-primary">
<strong>Lưu ý</strong>

<p class="mt-2">1. Một đơn hàng chỉ có giá trị trong vòng <strong>15 phút</strong> tính từ lúc tạo đơn hàng.</p>

<p>2. Khi chưa quá <strong>15 phút</strong> tính từ lúc tạo đơn hàng, đối với các trường hợp sau cần lặp lại quá trình gọi API để lấy kết quả <strong>cuối cùng</strong>:</p>
<ul>
  <li>Khi <code>return_code = 3</code> (Đơn hàng chưa thanh toán hoặc giao dịch đang xử lý)</li>
</ul>
</aside>
<h2 class='anchor-head' id='truy-van-trang-thai-thanh-toan-cua-don-hang_luong-xu-ly'>Luồng xử lý</h2>
<p><img src="../../images/v2/queryorder-v2.png" alt="Get status flow" /></p>
<h2 class='anchor-head' id='truy-van-trang-thai-thanh-toan-cua-don-hang_dac-ta-api'>Đặc tả API</h2>
<table><thead>
<tr>
<th>Environment</th>
<th>Method</th>
<th>Endpoint</th>
</tr>
</thead><tbody>
<tr>
<td><span class="code bg-orange">Sandbox</span></td>
<td><span class="code bg-success mr-1">POST</span></td>
<td>https://sb-openapi.zalopay.vn/v2/query</td>
</tr>
<tr>
<td><span class="code bg-danger">Real</span></td>
<td><span class="code bg-success mr-1">POST</span></td>
<td>https://openapi.zalopay.vn/v2/query</td>
</tr>
</tbody></table>

<p><strong>Content-Type</strong>: </p>

<p><code>application/x-www-form-urlencoded</code></p>

<p><code>application/json</code></p>

<p><code>application/xml</code></p>
<h3 class='anchor-head' id='truy-van-trang-thai-thanh-toan-cua-don-hang_dac-ta-api_du-lieu-truyen-vao-api'>Dữ liệu truyền vào api</h3>
<table><thead>
<tr>
<th style="text-align: left"><div style="width:130px">Tham số</div></th>
<th style="text-align: left">Kiểu dữ liệu</th>
<th style="text-align: left">Bắt buộc</th>
<th style="text-align: left">Ý nghĩa</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>app_id</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left"><code>app_id</code> của đơn hàng</td>
</tr>
<tr>
<td style="text-align: left"><code>app_trans_id</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left"><code>app_trans_id</code> của đơn hàng</td>
</tr>
<tr>
<td style="text-align: left"><code>mac</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">&bull; Thông tin chứng thực dữ liệu <br/> &bull; <code>= HMAC(hmac_algorithm, key1, app_id+&quot;&#124;&quot;+app_trans_id+&quot;&#124;&quot;+key1)</code></td>
</tr>
</tbody></table>
<h3 class='anchor-head' id='truy-van-trang-thai-thanh-toan-cua-don-hang_dac-ta-api_tham-so-api-tra-ve'>Tham số api trả về</h3>
<table><thead>
<tr>
<th style="text-align: left">Tham số</th>
<th style="text-align: left">Kiểu dữ liệu</th>
<th style="text-align: left">Ý nghĩa</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>return_code</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left"><code>1</code> : Thành công <br/> <code>2</code> : Thất bại <br/> <code>3</code> : Đơn hàng chưa thanh toán hoặc giao dịch đang xử lý</td>
</tr>
<tr>
<td style="text-align: left"><code>return_message</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Thông tin trạng thái đơn hàng</td>
</tr>
<tr>
<td style="text-align: left"><code>sub_return_code</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left">Mã trạng thái chi tiết</td>
</tr>
<tr>
<td style="text-align: left"><code>sub_return_message</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Thông tin chi tiết trạng thái đơn hàng</td>
</tr>
<tr>
<td style="text-align: left"><code>is_processing</code></td>
<td style="text-align: left">Boolean</td>
<td style="text-align: left">Trạng thái xử lý</td>
</tr>
<tr>
<td style="text-align: left"><code>amount</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left">Số tiền ứng dụng nhận được (chỉ có ý nghĩa khi thanh toán thành công)</td>
</tr>
<tr>
<td style="text-align: left"><code>discount_amount</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left">Số tiền giảm giá</td>
</tr>
<tr>
<td style="text-align: left"><code>zp_trans_id</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left">Mã giao dịch của ZaloPay</td>
</tr>
</tbody></table>
<h2 class='anchor-head' id='truy-van-trang-thai-thanh-toan-cua-don-hang_code-mau'>Code mẫu</h2>
<div class="zlp-lang-selector"></div>
<pre class="highlight csharp tab-csharp"><code><span class="cm">/**
 * .Net core 2.1.505
 */</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ZaloPay.Helper</span><span class="p">;</span> <span class="c1">// HmacHelper, RSAHelper, HttpHelper, Utils (tải về ở mục DOWNLOADS)</span>
<span class="k">using</span> <span class="nn">ZaloPay.Helper.Crypto</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span> <span class="c1">// https://www.newtonsoft.com/json</span>

<span class="k">namespace</span> <span class="nn">ZaloPayExample</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">appid</span> <span class="p">=</span> <span class="s">"2553"</span><span class="p">;</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">key1</span> <span class="p">=</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">;</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">query_order_url</span> <span class="p">=</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/query"</span><span class="p">;</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">app_trans_id</span> <span class="p">=</span> <span class="s">"&lt;app_trans_id&gt;"</span><span class="p">;</span>  <span class="c1">// Input your app_trans_id</span>

            <span class="kt">var</span> <span class="n">param</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"app_id"</span><span class="p">,</span> <span class="n">appid</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"app_trans_id"</span><span class="p">,</span> <span class="n">app_trans_id</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="n">appid</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">app_trans_id</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">key1</span><span class="p">;</span> 

            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"mac"</span><span class="p">,</span> <span class="n">HmacHelper</span><span class="p">.</span><span class="nf">Compute</span><span class="p">(</span><span class="n">ZaloPayHMAC</span><span class="p">.</span><span class="n">HMACSHA256</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">data</span><span class="p">));</span>

            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">HttpHelper</span><span class="p">.</span><span class="nf">PostFormAsync</span><span class="p">(</span><span class="n">query_order_url</span><span class="p">,</span> <span class="n">param</span><span class="p">);</span>

            <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"{0} = {1}"</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// Java version "1.8.0_201"</span>

<span class="kn">import</span> <span class="nn">org.apache.http.NameValuePair</span><span class="o">;</span> <span class="c1">// https://mvnrepository.com/artifact/org.apache.httpcomponents/httpclient</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.CloseableHttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.utils.URIBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.message.BasicNameValuePair</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.json.JSONObject</span><span class="o">;</span> <span class="c1">// https://mvnrepository.com/artifact/org.json/json</span>

<span class="kn">import</span> <span class="nn">vn.zalopay.crypto.HMACUtil</span><span class="o">;</span> <span class="c1">// tải về ở mục DOWNLOADS</span>

<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GetOrderStatus</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(){{</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">,</span> <span class="s">"2553"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"key1"</span><span class="o">,</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"key2"</span><span class="o">,</span> <span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"endpoint"</span><span class="o">,</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/query"</span><span class="o">);</span>
    <span class="o">}};</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">app_trans_id</span> <span class="o">=</span> <span class="s">"210608_2553_1623145380738"</span><span class="o">;</span>  <span class="c1">// Input your app_trans_id</span>
      <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">)</span> <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">app_trans_id</span>  <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"key1"</span><span class="o">);</span> <span class="c1">// appid|app_trans_id|key1</span>
      <span class="n">String</span> <span class="n">mac</span> <span class="o">=</span> <span class="n">HMACUtil</span><span class="o">.</span><span class="na">HMacHexStringEncode</span><span class="o">(</span><span class="n">HMACUtil</span><span class="o">.</span><span class="na">HMACSHA256</span><span class="o">,</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"key1"</span><span class="o">),</span> <span class="n">data</span><span class="o">);</span>

      <span class="n">List</span><span class="o">&lt;</span><span class="n">NameValuePair</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
      <span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicNameValuePair</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">,</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">)));</span>
      <span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicNameValuePair</span><span class="o">(</span><span class="s">"app_trans_id"</span><span class="o">,</span> <span class="n">app_trans_id</span><span class="o">));</span>
      <span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicNameValuePair</span><span class="o">(</span><span class="s">"mac"</span><span class="o">,</span> <span class="n">mac</span><span class="o">));</span>

      <span class="n">URIBuilder</span> <span class="n">uri</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URIBuilder</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"endpoint"</span><span class="o">));</span>
      <span class="n">uri</span><span class="o">.</span><span class="na">addParameters</span><span class="o">(</span><span class="n">params</span><span class="o">);</span>

      <span class="n">CloseableHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
      <span class="n">HttpPost</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
      <span class="n">post</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="k">new</span> <span class="n">UrlEncodedFormEntity</span><span class="o">(</span><span class="n">params</span><span class="o">));</span>

      <span class="n">CloseableHttpResponse</span> <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
      <span class="n">BufferedReader</span> <span class="n">rd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="na">getEntity</span><span class="o">().</span><span class="na">getContent</span><span class="o">()));</span>
      <span class="n">StringBuilder</span> <span class="n">resultJsonStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
      <span class="n">String</span> <span class="n">line</span><span class="o">;</span>

      <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">resultJsonStr</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="n">JSONObject</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">resultJsonStr</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">key</span> <span class="o">:</span> <span class="n">result</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%s = %s\n"</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
      <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight go tab-go"><code><span class="c">// go version go1.11.1 linux/amd64</span><span class="x">
</span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
    </span><span class="s">"bytes"</span><span class="x">
    </span><span class="s">"encoding/json"</span><span class="x">
    </span><span class="s">"fmt"</span><span class="x">
    </span><span class="s">"io/ioutil"</span><span class="x">
    </span><span class="s">"log"</span><span class="x">
    </span><span class="s">"net/http"</span><span class="x">

    </span><span class="s">"github.com/zpmep/hmacutil"</span><span class="x"> </span><span class="c">// go get github.com/zpmep/hmacutil</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">var</span><span class="x"> </span><span class="p">(</span><span class="x">
    </span><span class="n">appID</span><span class="x">      </span><span class="o">=</span><span class="x"> </span><span class="m">2553</span><span class="x">
    </span><span class="n">key1</span><span class="x">       </span><span class="o">=</span><span class="x"> </span><span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="x">
    </span><span class="n">key2</span><span class="x">       </span><span class="o">=</span><span class="x"> </span><span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="x">
    </span><span class="n">appTransID</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"&lt;app_trans_id&gt;"</span><span class="x"> </span><span class="c">// Input your app trans id</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="n">data</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%v|%s|%s"</span><span class="p">,</span><span class="x"> </span><span class="n">appID</span><span class="p">,</span><span class="x"> </span><span class="n">appTransID</span><span class="p">,</span><span class="x"> </span><span class="n">key1</span><span class="p">)</span><span class="x"> </span><span class="c">// appid|apptransid|key1</span><span class="x">
    </span><span class="n">params</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}{</span><span class="x">
        </span><span class="s">"app_id"</span><span class="o">:</span><span class="x">       </span><span class="n">appID</span><span class="p">,</span><span class="x">
        </span><span class="s">"app_trans_id"</span><span class="o">:</span><span class="x"> </span><span class="n">appTransID</span><span class="p">,</span><span class="x">
        </span><span class="s">"mac"</span><span class="o">:</span><span class="x">          </span><span class="n">hmacutil</span><span class="o">.</span><span class="n">HexStringEncode</span><span class="p">(</span><span class="n">hmacutil</span><span class="o">.</span><span class="n">SHA256</span><span class="p">,</span><span class="x"> </span><span class="n">key1</span><span class="p">,</span><span class="x"> </span><span class="n">data</span><span class="p">),</span><span class="x">
    </span><span class="p">}</span><span class="x">

    </span><span class="n">jsonStr</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="x">
    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">

    </span><span class="n">res</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">Post</span><span class="p">(</span><span class="s">"https://sb-openapi.zalopay.vn/v2/query"</span><span class="p">,</span><span class="x"> </span><span class="s">"application/json"</span><span class="p">,</span><span class="x"> </span><span class="n">bytes</span><span class="o">.</span><span class="n">NewBuffer</span><span class="p">(</span><span class="n">jsonStr</span><span class="p">))</span><span class="x">

    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
    </span><span class="k">defer</span><span class="x"> </span><span class="n">res</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span><span class="x">

    </span><span class="n">body</span><span class="p">,</span><span class="x"> </span><span class="n">_</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">ioutil</span><span class="o">.</span><span class="n">ReadAll</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span><span class="x">

    </span><span class="k">var</span><span class="x"> </span><span class="n">result</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}</span><span class="x">

    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">(</span><span class="n">body</span><span class="p">,</span><span class="x"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">);</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">

    </span><span class="k">for</span><span class="x"> </span><span class="n">k</span><span class="p">,</span><span class="x"> </span><span class="n">v</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">result</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%s = %+v"</span><span class="p">,</span><span class="x"> </span><span class="n">k</span><span class="p">,</span><span class="x"> </span><span class="n">v</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// Node v10.15.3</span>
<span class="kr">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'axios'</span><span class="p">).</span><span class="k">default</span><span class="p">;</span> <span class="c1">// npm install axios</span>
<span class="kr">const</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'crypto-js'</span><span class="p">);</span> <span class="c1">// npm install crypto-js</span>
<span class="kr">const</span> <span class="nx">qs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'qs'</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">app_id</span><span class="p">:</span> <span class="s2">"2553"</span><span class="p">,</span>
    <span class="na">key1</span><span class="p">:</span> <span class="s2">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
    <span class="na">key2</span><span class="p">:</span> <span class="s2">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
    <span class="na">endpoint</span><span class="p">:</span> <span class="s2">"https://sb-openapi.zalopay.vn/v2/query"</span>
<span class="p">};</span>

<span class="kd">let</span> <span class="nx">postData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">app_id</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">app_id</span><span class="p">,</span>
    <span class="na">app_trans_id</span><span class="p">:</span> <span class="s2">"&lt;app_trans_id&gt;"</span><span class="p">,</span> <span class="c1">// Input your app_trans_id</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">postData</span><span class="p">.</span><span class="nx">app_id</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">postData</span><span class="p">.</span><span class="nx">app_trans_id</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">config</span><span class="p">.</span><span class="nx">key1</span><span class="p">;</span> <span class="c1">// appid|app_trans_id|key1</span>
<span class="nx">postData</span><span class="p">.</span><span class="nx">mac</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">key1</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>


<span class="kd">let</span> <span class="nx">postConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="s1">'post'</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/x-www-form-urlencoded'</span>
    <span class="p">},</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">postData</span><span class="p">)</span>
<span class="p">};</span>

<span class="nx">axios</span><span class="p">(</span><span class="nx">postConfig</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

<span class="c1">// PHP Version 7.3.3
</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"app_id"</span> <span class="o">=&gt;</span> <span class="mi">2553</span><span class="p">,</span>
  <span class="s2">"key1"</span> <span class="o">=&gt;</span> <span class="s2">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
  <span class="s2">"key2"</span> <span class="o">=&gt;</span> <span class="s2">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
  <span class="s2">"endpoint"</span> <span class="o">=&gt;</span> <span class="s2">"https://sb-openapi.zalopay.vn/v2/query"</span>
<span class="p">];</span>

<span class="nv">$app_trans_id</span> <span class="o">=</span> <span class="s2">"&lt;app_trans_id&gt;"</span><span class="p">;</span>  <span class="c1">// Input your app_trans_id
</span><span class="nv">$data</span> <span class="o">=</span> <span class="nv">$config</span><span class="p">[</span><span class="s2">"app_id"</span><span class="p">]</span><span class="o">.</span><span class="s2">"|"</span><span class="o">.</span><span class="nv">$app_trans_id</span><span class="o">.</span><span class="s2">"|"</span><span class="o">.</span><span class="nv">$config</span><span class="p">[</span><span class="s2">"key1"</span><span class="p">];</span> <span class="c1">// app_id|app_trans_id|key1
</span><span class="nv">$params</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"app_id"</span> <span class="o">=&gt;</span> <span class="nv">$config</span><span class="p">[</span><span class="s2">"app_id"</span><span class="p">],</span>
  <span class="s2">"app_trans_id"</span> <span class="o">=&gt;</span> <span class="nv">$app_trans_id</span><span class="p">,</span>
  <span class="s2">"mac"</span> <span class="o">=&gt;</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s2">"sha256"</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s2">"key1"</span><span class="p">])</span>
<span class="p">];</span>

<span class="nv">$context</span> <span class="o">=</span> <span class="nb">stream_context_create</span><span class="p">([</span>
    <span class="s2">"http"</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s2">"header"</span> <span class="o">=&gt;</span> <span class="s2">"Content-type: application/x-www-form-urlencoded</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">,</span>
        <span class="s2">"method"</span> <span class="o">=&gt;</span> <span class="s2">"POST"</span><span class="p">,</span>
        <span class="s2">"content"</span> <span class="o">=&gt;</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$params</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">]);</span>

<span class="nv">$resp</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s2">"endpoint"</span><span class="p">],</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">$context</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$resp</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s2">"</span><span class="nv">$key</span><span class="s2">: </span><span class="nv">$value</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code><span class="c1"># ruby 2.5.1p57</span>

<span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span> <span class="c1"># gem install openssl</span>
<span class="nb">require</span> <span class="s1">'net/http'</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">app_id: </span><span class="s1">'2553'</span><span class="p">,</span>
  <span class="ss">key1: </span><span class="s1">'PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL'</span><span class="p">,</span>
  <span class="ss">key2: </span><span class="s1">'kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz'</span><span class="p">,</span>
  <span class="ss">endpoint: </span><span class="s1">'https://sb-openapi.zalopay.vn/v2/query'</span>
<span class="p">}</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">app_id: </span><span class="n">config</span><span class="p">[</span><span class="ss">:app_id</span><span class="p">],</span>
  <span class="ss">app_trans_id: </span><span class="s2">"&lt;app_trans_id&gt;"</span><span class="p">,</span>  <span class="c1"># Input your app_trans_id</span>
<span class="p">}</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="ss">:app_id</span><span class="p">]</span> <span class="o">+</span><span class="s2">"|"</span><span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="ss">:app_trans_id</span><span class="p">]</span> <span class="o">+</span><span class="s2">"|"</span><span class="o">+</span> <span class="n">config</span><span class="p">[</span><span class="ss">:key1</span><span class="p">]</span> <span class="c1"># app_id|app_trans_id|key1</span>
<span class="n">params</span><span class="p">[</span><span class="ss">:mac</span><span class="p">]</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="ss">:key1</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">post_form</span><span class="p">(</span><span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="ss">:endpoint</span><span class="p">]),</span> <span class="n">params</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>

<span class="n">result</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre><pre class="highlight python tab-python"><code><span class="c"># coding=utf-8</span>
<span class="c"># Python 3.6</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="nn">hmac</span><span class="p">,</span> <span class="n">hashlib</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"app_id"</span><span class="p">:</span> <span class="mi">2553</span><span class="p">,</span>
  <span class="s">"key1"</span><span class="p">:</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
  <span class="s">"key2"</span><span class="p">:</span> <span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
  <span class="s">"endpoint"</span><span class="p">:</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/query"</span>
<span class="p">}</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"app_id"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"app_id"</span><span class="p">],</span>
  <span class="s">"app_trans_id"</span><span class="p">:</span> <span class="s">"&lt;app_trans_id&gt;"</span>  <span class="c"># Input your app_trans_id"</span>
<span class="p">}</span>

<span class="n">data</span> <span class="o">=</span> <span class="s">"{}|{}|{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">"app_id"</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">"app_trans_id"</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s">"key1"</span><span class="p">])</span> <span class="c"># app_id|app_trans_id|key1</span>
<span class="n">params</span><span class="p">[</span><span class="s">"mac"</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">'key1'</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"endpoint"</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"{}: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
</code></pre><pre class="highlight shell"><code>curl https://sb-openapi.zalopay.vn/v2/query <span class="se">\</span>
  -d <span class="nv">app_id</span><span class="o">=</span>2553 <span class="se">\</span>
  -d <span class="nv">app_trans_id</span><span class="o">=</span>190419_123456 <span class="se">\</span>
  -d <span class="nv">mac</span><span class="o">=</span>440f389ddd834b40f21f9baed9448b530b6d7a9af722d747f3fa0af68c007c2e <span class="c"># app_id|app_trans_id|key1</span>
</code></pre>
<aside class="alert alert-primary">
<a href="/downloads/">Tải về các thư viện hỗ trợ tại đây</a>
</aside>
<h1 class='anchor-head' id='hoan-tien-giao-dich'>Hoàn tiền giao dịch</h1>
<p>API cho phép đối tác hoàn tiền toàn phần hoặc từng phần của 1 giao dịch thanh toán thành công qua ZaloPay.</p>
<h3 class='anchor-head' id='hoan-tien-giao-dich_quy-tac-hoan-tien'>Quy tắc hoàn tiền</h3>
<div class="table-responsive">
  <table class="table info-table">
    <thead>
      <tr>
        <th>HÌNH THỨC THANH TOÁN</th>
        <th style="width: 20%">NGUỒN TIỀN</th>
        <th style="width: 18%">HOÀN TIỀN VỀ</th>
        <th>THỜI GIAN HOÀN TIỀN</th>
        <th>NGÂN HÀNG HỖ TRỢ</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td rowspan="3">Ứng dụng ZaloPay</td>
        <td>Ví ZaloPay</td>
        <td>Ví ZaloPay</td>
        <td>Ngay lập tức</td>
        <td rowspan="3">Vietcombank, Vietinbank, BIDV, Sacombank, Eximbank, SCB, Bản Việt, JCB</td>
      </tr>
      <tr>
        <td>ATM / Tài khoản ngân hàng</td>
        <td>Ví ZaloPay</td>
        <td>Ngay lập tức</td>
      </tr>
      <tr>
        <td>Visa / Master / JCB</td>
        <td>Thẻ</td>
        <td>5 - 7 ngày làm việc</td>
      </tr>
      <tr class="bg-grey">
        <td rowspan="2">Thanh toán Thẻ/Tài khoản ngân hàng qua cổng ZaloPay Gateway</td>
        <td>ATM / Tài khoản ngân hàng</td>
        <td>Tài khoản ngân hàng</td>
        <td>3 - 5 ngày làm việc (tùy ngân hàng)</td>
        <td rowspan="2">ABBank, ACB, Agribank, Bắc Á Bank, Bảo Việt Bank, BIDV, Đông Á Bank, Eximbank, GP Bank, HD Bank, Liên Việt Post Bank, Maritime Bank, MB Bank, Nam Á Bank, NCB, Bản Việt, OCB, Ocean Bank, PG Bank, Sacombank, Saigon Bank, SCB, SeA Bank, SHB, Techcombank, TP Bank, VIB</td>
      </tr>
      <tr class="bg-grey">
        <td>Visa / Master / JCB</td>
        <td>Thẻ</td>
        <td>5 - 7 ngày làm việc (tùy ngân hàng)</td>
      </tr>
    </tbody>
  </table>
</div> 
<h2 class='anchor-head' id='hoan-tien-giao-dich_luong-xu-ly'>Luồng xử lý</h2>
<p><img src="../../images/v2/refund-v2.png" alt="Refund flow" /></p>
<h2 class='anchor-head' id='hoan-tien-giao-dich_dac-ta-api'>Đặc tả API</h2>
<table><thead>
<tr>
<th>Environment</th>
<th>Method</th>
<th>Endpoint</th>
</tr>
</thead><tbody>
<tr>
<td><span class="code bg-orange">Sandbox</span></td>
<td><span class="code bg-primary">POST</span></td>
<td>https://sb-openapi.zalopay.vn/v2/refund</td>
</tr>
<tr>
<td><span class="code bg-danger">Real</span></td>
<td><span class="code bg-primary">POST</span></td>
<td>https://openapi.zalopay.vn/v2/refund</td>
</tr>
</tbody></table>

<ul>
<li><strong>Content-Type</strong>:</li>
</ul>

<p><code>application/x-www-form-urlencoded</code></p>

<p><code>application/json</code></p>

<p><code>application/xml</code></p>
<h3 class='anchor-head' id='hoan-tien-giao-dich_dac-ta-api_du-lieu-truyen-vao-api'>Dữ liệu truyền vào api</h3>
<table><thead>
<tr>
<th style="text-align: left"><div style="width:140px">Tham số </div></th>
<th style="text-align: left">Kiểu dữ liệu</th>
<th style="text-align: left">Kích thước</th>
<th style="text-align: left">Bắt buộc</th>
<th style="text-align: left">Ý nghĩa</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>m_refund_id</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">45</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">&bull; Merchant phải tự gen ra mã giao dịch riêng của mình khi submit yêu cầu hoàn tiền.<br/> &bull; Định dạng: <code>yymmdd_appid_xxxxxxxxxx</code></td>
</tr>
<tr>
<td style="text-align: left"><code>app_id</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left"></td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Merchant app id đã được cấp khi đăng ký với ZaloPay.</td>
</tr>
<tr>
<td style="text-align: left"><code>zp_trans_id</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">15</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">&bull; Mã giao dịch muốn hoàn tiền. <br/> &bull; Mã này được Zalo Pay trả về khi thanh toán.</td>
</tr>
<tr>
<td style="text-align: left"><code>amount</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left"></td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Số tiền muốn hoàn lại cho khách hàng</td>
</tr>
<tr>
<td style="text-align: left"><code>refund_fee_amount</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
<td style="text-align: left">Phí của giao dịch hoàn tiền. Phí này sẽ được trích ra từ phần tiền người mua hàng nhận lại được từ giao dịch hoàn tiền. Nếu không cần phí hoàn, bạn có thể bỏ qua trường dữ liệu này.</td>
</tr>
<tr>
<td style="text-align: left"><code>timestamp</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left">13</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">&bull; Thời điểm thực hiện việc hoàn tiền (unix timestamp in milisecond).<br/> &bull; Thời gian tính đến milisecond, và lấy theo current time</td>
</tr>
<tr>
<td style="text-align: left"><code>mac</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left"></td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Thông tin chứng thực (xem cách tạo thông tin chứng thực bên dưới)</td>
</tr>
<tr>
<td style="text-align: left"><code>description</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">100</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Lý do hoàn tiền</td>
</tr>
</tbody></table>
<h3 class='anchor-head' id='hoan-tien-giao-dich_dac-ta-api_tao-thong-tin-chung-thuc'>Tạo thông tin chứng thực</h3><pre class="highlight shell tab-shell"><code>mac <span class="o">=</span> HMAC<span class="o">(</span>hmac_algorithm, key1, hmac_input<span class="o">)</span>
</code></pre>
<p>Trong đó:</p>

<ul>
<li><strong>hmac_algorithm</strong>: Là phương thức bảo mật do ứng dụng đăng ký với ZaloPay, mặc định là <code>HmacSHA256</code></li>
<li><strong>key1</strong>: Là Mac Key do ZaloPay cung cấp cho ứng dụng lúc đăng ký ứng dụng</li>
<li><strong>hmac_input</strong>: Nếu không có phí hoàn (refund_fee_amount): <code>hmac_input = app_id +&quot;|&quot;+ zp_trans_id +&quot;|&quot;+ amount +&quot;|&quot;+ description +&quot;|&quot;+ timestamp</code>; nếu có phí hoàn: <code>hmac_input = app_id +&quot;|&quot;+ zp_trans_id +&quot;|&quot;+ amount +&quot;|&quot;+ refund_fee_amount +&quot;|&quot;+ description +&quot;|&quot;+ timestamp</code>.</li>
</ul>
<h3 class='anchor-head' id='hoan-tien-giao-dich_dac-ta-api_tham-so-api-tra-ve'>Tham số api trả về</h3>
<table><thead>
<tr>
<th style="text-align: left">Tham số</th>
<th style="text-align: left">Kiểu dữ liệu</th>
<th style="text-align: left">Ý nghĩa</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>return_code</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left"><code>1</code> : Hoàn tiền giao dịch thành công</td>
</tr>
<tr>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
<td style="text-align: left"><code>2</code> : Hoàn tiền thất bại, cần thực hiện lại giao dịch</td>
</tr>
<tr>
<td style="text-align: left"></td>
<td style="text-align: left"></td>
<td style="text-align: left"><code>3</code> : Đang hoàn tiền, gọi query_refund api để lấy trạng thái cuối cùng</td>
</tr>
<tr>
<td style="text-align: left"><code>return_message</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Thông tin trạng thái</td>
</tr>
<tr>
<td style="text-align: left"><code>sub_return_code</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left">Thông tin chi tiết mã lỗi hoàn tiền</td>
</tr>
<tr>
<td style="text-align: left"><code>sub_return_message</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Thông tin chi tiết trạng thái</td>
</tr>
<tr>
<td style="text-align: left"><code>refund_id</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left">Mã giao dịch hoàn tiền của ZaloPay, cần lưu lại để đối chiếu</td>
</tr>
</tbody></table>
<h2 class='anchor-head' id='hoan-tien-giao-dich_code-mau'>Code mẫu</h2>
<div class="zlp-lang-selector"></div>
<pre class="highlight csharp tab-csharp"><code><span class="cm">/**
 * .Net core 2.1.505
 */</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ZaloPay.Helper</span><span class="p">;</span> <span class="c1">// HmacHelper, RSAHelper, HttpHelper, Utils (tải về ở mục DOWNLOADS)</span>
<span class="k">using</span> <span class="nn">ZaloPay.Helper.Crypto</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span> <span class="c1">// https://www.newtonsoft.com/json</span>

<span class="k">namespace</span> <span class="nn">ZaloPayExample</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">app_id</span> <span class="p">=</span> <span class="s">"2553"</span><span class="p">;</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">key1</span> <span class="p">=</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">;</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">refund_url</span> <span class="p">=</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/refund"</span><span class="p">;</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">timestamp</span> <span class="p">=</span> <span class="n">Utils</span><span class="p">.</span><span class="nf">GetTimeStamp</span><span class="p">().</span><span class="nf">ToString</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">rand</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">uid</span> <span class="p">=</span> <span class="n">timestamp</span><span class="p">+</span><span class="s">""</span><span class="p">+</span><span class="n">rand</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">111</span><span class="p">,</span> <span class="m">999</span><span class="p">).</span><span class="nf">ToString</span><span class="p">();</span> 

            <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">param</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"app_id"</span><span class="p">,</span> <span class="n">app_id</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"m_refund_id"</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"yyMMdd"</span><span class="p">)</span> <span class="p">+</span> <span class="s">"_"</span> <span class="p">+</span> <span class="n">app_id</span> <span class="p">+</span> <span class="s">"_"</span> <span class="p">+</span> <span class="n">uid</span><span class="p">);</span> 
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"zp_trans_id"</span><span class="p">,</span> <span class="s">"1234567"</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"amount"</span><span class="p">,</span> <span class="s">"1000"</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"description"</span><span class="p">,</span> <span class="s">"demo"</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="n">app_id</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"zp_trans_id"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"amount"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"description"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"timestamp"</span><span class="p">];</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"mac"</span><span class="p">,</span> <span class="n">HmacHelper</span><span class="p">.</span><span class="nf">Compute</span><span class="p">(</span><span class="n">ZaloPayHMAC</span><span class="p">.</span><span class="n">HMACSHA256</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">data</span><span class="p">));</span>

            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">HttpHelper</span><span class="p">.</span><span class="nf">PostFormAsync</span><span class="p">(</span><span class="n">refund_url</span><span class="p">,</span> <span class="n">param</span><span class="p">);</span>

            <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"{0} = {1}"</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// Java version "1.8.0_201"</span>
<span class="kn">import</span> <span class="nn">org.apache.http.NameValuePair</span><span class="o">;</span> <span class="c1">// https://mvnrepository.com/artifact/org.apache.httpcomponents/httpclient</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.entity.UrlEncodedFormEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.CloseableHttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.message.BasicNameValuePair</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.json.JSONObject</span><span class="o">;</span> <span class="c1">// https://mvnrepository.com/artifact/org.json/json</span>
<span class="kn">import</span> <span class="nn">vn.zalopay.crypto.HMACUtil</span><span class="o">;</span> <span class="c1">// tải về ở mục DOWNLOADS</span>

<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Refund</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">App</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(){{</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">,</span> <span class="s">"2553"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"key1"</span><span class="o">,</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"key2"</span><span class="o">,</span> <span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"refund_url"</span><span class="o">,</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/refund"</span><span class="o">);</span>
    <span class="o">}};</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getCurrentTimeString</span><span class="o">(</span><span class="n">String</span> <span class="n">format</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Calendar</span> <span class="n">cal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GregorianCalendar</span><span class="o">(</span><span class="n">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s">"GMT+7"</span><span class="o">));</span>
        <span class="n">SimpleDateFormat</span> <span class="n">fmt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="n">format</span><span class="o">);</span>
        <span class="n">fmt</span><span class="o">.</span><span class="na">setCalendar</span><span class="o">(</span><span class="n">cal</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">cal</span><span class="o">.</span><span class="na">getTimeInMillis</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span> <span class="n">String</span><span class="o">[]</span> <span class="n">args</span> <span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
    <span class="o">{</span>
        <span class="n">String</span> <span class="n">appid</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"appid"</span><span class="o">);</span>
        <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span> <span class="c1">// miliseconds</span>
        <span class="n">String</span> <span class="n">uid</span> <span class="o">=</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="s">""</span> <span class="o">+</span> <span class="o">(</span><span class="mi">111</span> <span class="o">+</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">888</span><span class="o">));</span> <span class="c1">// unique id</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">order</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;(){{</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">,</span> <span class="n">appid</span><span class="o">);</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"zp_trans_id"</span><span class="o">,</span> <span class="mi">123456789</span><span class="o">);</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"m_refund_id"</span><span class="o">,</span> <span class="n">getCurrentTimeString</span><span class="o">(</span><span class="s">"yyMMdd"</span><span class="o">)</span> <span class="o">+</span><span class="s">"_"</span><span class="o">+</span> <span class="n">appid</span> <span class="o">+</span><span class="s">"_"</span><span class="o">+</span><span class="n">uid</span><span class="o">);</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"timestamp"</span><span class="o">,</span> <span class="n">timestamp</span><span class="o">);</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"amount"</span><span class="o">,</span> <span class="mi">50000</span><span class="o">);</span>
            <span class="n">put</span><span class="o">(</span><span class="s">"description"</span><span class="o">,</span> <span class="s">"ZaloPay Intergration Demo"</span><span class="o">);</span>
        <span class="o">}};</span>

        <span class="c1">// appid|zptransid|amount|description|timestamp</span>
        <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">)</span> <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"zp_trans_id"</span><span class="o">)</span> <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"amount"</span><span class="o">)</span>
                <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"description"</span><span class="o">)</span> <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"timestamp"</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"mac"</span><span class="o">,</span> <span class="n">HMACUtil</span><span class="o">.</span><span class="na">HMacHexStringEncode</span><span class="o">(</span><span class="n">HMACUtil</span><span class="o">.</span><span class="na">HMACSHA256</span><span class="o">,</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"key1"</span><span class="o">),</span> <span class="n">data</span><span class="o">));</span>

        <span class="n">CloseableHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
        <span class="n">HttpPost</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"refund_url"</span><span class="o">));</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">NameValuePair</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">:</span> <span class="n">order</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicNameValuePair</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">toString</span><span class="o">()));</span>
        <span class="o">}</span>

        <span class="n">post</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="k">new</span> <span class="n">UrlEncodedFormEntity</span><span class="o">(</span><span class="n">params</span><span class="o">));</span>

        <span class="n">CloseableHttpResponse</span> <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
        <span class="n">BufferedReader</span> <span class="n">rd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="na">getEntity</span><span class="o">().</span><span class="na">getContent</span><span class="o">()));</span>
        <span class="n">StringBuilder</span> <span class="n">resultJsonStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">line</span><span class="o">;</span>

        <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">resultJsonStr</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">JSONObject</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">resultJsonStr</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">key</span> <span class="o">:</span> <span class="n">result</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%s = %s\n"</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight go tab-go"><code><span class="c">// go version go1.11.1 linux/amd64</span><span class="x">
</span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
    </span><span class="s">"encoding/json"</span><span class="x">
    </span><span class="s">"fmt"</span><span class="x">
    </span><span class="s">"io/ioutil"</span><span class="x">
    </span><span class="s">"log"</span><span class="x">
    </span><span class="s">"net/http"</span><span class="x">
    </span><span class="s">"net/url"</span><span class="x">
    </span><span class="s">"strconv"</span><span class="x">
    </span><span class="s">"time"</span><span class="x">

    </span><span class="s">"github.com/zpmep/hmacutil"</span><span class="x"> </span><span class="c">// go get github.com/zpmep/hmacutil</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">var</span><span class="x"> </span><span class="p">(</span><span class="x">
    </span><span class="n">appID</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"2553"</span><span class="x">
    </span><span class="n">key1</span><span class="x">  </span><span class="o">=</span><span class="x"> </span><span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="x">
    </span><span class="n">key2</span><span class="x">  </span><span class="o">=</span><span class="x"> </span><span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="n">params</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="nb">make</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">Values</span><span class="p">)</span><span class="x">
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"app_id"</span><span class="p">,</span><span class="x"> </span><span class="n">appID</span><span class="p">)</span><span class="x">
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"zp_trans_id"</span><span class="p">,</span><span class="x"> </span><span class="s">"190508000000017"</span><span class="p">)</span><span class="x">
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"amount"</span><span class="p">,</span><span class="x"> </span><span class="s">"50000"</span><span class="p">)</span><span class="x">
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"description"</span><span class="p">,</span><span class="x"> </span><span class="s">"ZaloPay Refund Demo"</span><span class="p">)</span><span class="x">

    </span><span class="n">now</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="x">
    </span><span class="n">timestamp</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">now</span><span class="o">.</span><span class="n">UnixNano</span><span class="p">()</span><span class="x"> </span><span class="o">/</span><span class="x"> </span><span class="kt">int64</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span><span class="p">)</span><span class="x"> </span><span class="c">// Miliseconds</span><span class="x">
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span><span class="x"> </span><span class="n">strconv</span><span class="o">.</span><span class="n">FormatInt</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span><span class="x"> </span><span class="m">10</span><span class="p">))</span><span class="x">

  </span><span class="n">uid</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%d%d"</span><span class="p">,</span><span class="x"> </span><span class="n">timestamp</span><span class="p">,</span><span class="x"> </span><span class="m">111</span><span class="o">+</span><span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="m">888</span><span class="p">))</span><span class="x">

    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"m_refund_id"</span><span class="p">,</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%02d%02d%02d_%v_%v"</span><span class="p">,</span><span class="x"> </span><span class="n">now</span><span class="o">.</span><span class="n">Year</span><span class="p">()</span><span class="o">%</span><span class="m">100</span><span class="p">,</span><span class="x"> </span><span class="kt">int</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">Month</span><span class="p">()),</span><span class="x"> </span><span class="n">now</span><span class="o">.</span><span class="n">Day</span><span class="p">(),</span><span class="x"> </span><span class="n">appID</span><span class="p">,</span><span class="x"> </span><span class="n">uid</span><span class="p">))</span><span class="x">

    </span><span class="c">// app_id|zp_trans_id|amount|description|timestamp</span><span class="x">
    </span><span class="n">data</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%v|%v|%v|%v|%v"</span><span class="p">,</span><span class="x"> </span><span class="n">appID</span><span class="p">,</span><span class="x"> </span><span class="n">params</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"zp_trans_id"</span><span class="p">),</span><span class="x"> </span><span class="n">params</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"amount"</span><span class="p">),</span><span class="x"> </span><span class="n">params</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"description"</span><span class="p">),</span><span class="x"> </span><span class="n">params</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">))</span><span class="x">
    </span><span class="n">params</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"mac"</span><span class="p">,</span><span class="x"> </span><span class="n">hmacutil</span><span class="o">.</span><span class="n">HexStringEncode</span><span class="p">(</span><span class="n">hmacutil</span><span class="o">.</span><span class="n">SHA256</span><span class="p">,</span><span class="x"> </span><span class="n">key1</span><span class="p">,</span><span class="x"> </span><span class="n">data</span><span class="p">))</span><span class="x">

    </span><span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%+v"</span><span class="p">,</span><span class="x"> </span><span class="n">params</span><span class="p">)</span><span class="x">

    </span><span class="c">// Content-Type: application/x-www-form-urlencoded</span><span class="x">
    </span><span class="n">res</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">PostForm</span><span class="p">(</span><span class="s">"https://sb-openapi.zalopay.vn/v2/refund"</span><span class="p">,</span><span class="x"> </span><span class="n">params</span><span class="p">)</span><span class="x">

    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
    </span><span class="k">defer</span><span class="x"> </span><span class="n">res</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span><span class="x">

    </span><span class="n">body</span><span class="p">,</span><span class="x"> </span><span class="n">_</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">ioutil</span><span class="o">.</span><span class="n">ReadAll</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span><span class="x">

    </span><span class="k">var</span><span class="x"> </span><span class="n">result</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}</span><span class="x">

    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">(</span><span class="n">body</span><span class="p">,</span><span class="x"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">);</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">

    </span><span class="k">for</span><span class="x"> </span><span class="n">k</span><span class="p">,</span><span class="x"> </span><span class="n">v</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">result</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%s = %v"</span><span class="p">,</span><span class="x"> </span><span class="n">k</span><span class="p">,</span><span class="x"> </span><span class="n">v</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// Node v10.15.3</span>
<span class="kr">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'axios'</span><span class="p">).</span><span class="k">default</span><span class="p">;</span> <span class="c1">// npm install axios</span>
<span class="kr">const</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'crypto-js'</span><span class="p">);</span> <span class="c1">// npm install crypto-js</span>
<span class="kr">const</span> <span class="nx">moment</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'moment'</span><span class="p">);</span> <span class="c1">// npm install moment</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">app_id</span><span class="p">:</span> <span class="s2">"2553"</span><span class="p">,</span>
  <span class="na">key1</span><span class="p">:</span> <span class="s2">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
  <span class="na">key2</span><span class="p">:</span> <span class="s2">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
  <span class="na">refund_url</span><span class="p">:</span> <span class="s2">"https://sb-openapi.zalopay.vn/v2/refund"</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">uid</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">timestamp</span><span class="p">}${</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="mi">111</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">999</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span> <span class="c1">// unique id</span>

<span class="kd">let</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">app_id</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">app_id</span><span class="p">,</span>
  <span class="na">m_refund_id</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">moment</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="s1">'YYMMDD'</span><span class="p">)}</span><span class="s2">_</span><span class="p">${</span><span class="nx">config</span><span class="p">.</span><span class="nx">app_id</span><span class="p">}</span><span class="s2">_</span><span class="p">${</span><span class="nx">uid</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
  <span class="nx">timestamp</span><span class="p">,</span> <span class="c1">// miliseconds</span>
  <span class="na">zp_trans_id</span><span class="p">:</span> <span class="s1">'190508000000022'</span><span class="p">,</span>
  <span class="na">amount</span><span class="p">:</span> <span class="s1">'50000'</span><span class="p">,</span>
  <span class="na">description</span><span class="p">:</span> <span class="s1">'ZaloPay Refund Demo'</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// app_id|zp_trans_id|amount|description|timestamp</span>
<span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">app_id</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">zp_trans_id</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">amount</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">description</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">;</span>
<span class="nx">params</span><span class="p">.</span><span class="nx">mac</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">key1</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>

<span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">refund_url</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span> <span class="nx">params</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">))</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

<span class="c1">// PHP Version 7.3.3
</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"app_id"</span> <span class="o">=&gt;</span> <span class="mi">2553</span><span class="p">,</span>
  <span class="s2">"key1"</span> <span class="o">=&gt;</span> <span class="s2">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
  <span class="s2">"key2"</span> <span class="o">=&gt;</span> <span class="s2">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
  <span class="s2">"refund_url"</span> <span class="o">=&gt;</span> <span class="s2">"https://sb-openapi.zalopay.vn/v2/refund"</span>
<span class="p">];</span>

<span class="nv">$timestamp</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">microtime</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span> <span class="c1">// miliseconds
</span><span class="nv">$uid</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$timestamp</span><span class="s2">"</span><span class="o">.</span><span class="nb">rand</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="mi">999</span><span class="p">);</span> <span class="c1">// unique id 
</span>
<span class="nv">$params</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"app_id"</span> <span class="o">=&gt;</span> <span class="nv">$config</span><span class="p">[</span><span class="s2">"app_id"</span><span class="p">],</span>
  <span class="s2">"m_refund_id"</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s2">"ymd"</span><span class="p">)</span><span class="o">.</span><span class="s2">"_"</span><span class="o">.</span><span class="nv">$config</span><span class="p">[</span><span class="s2">"app_id"</span><span class="p">]</span><span class="o">.</span><span class="s2">"_"</span><span class="o">.</span><span class="nv">$uid</span><span class="p">,</span>
  <span class="s2">"timestamp"</span> <span class="o">=&gt;</span> <span class="nv">$timestamp</span><span class="p">,</span>
  <span class="s2">"zp_trans_id"</span> <span class="o">=&gt;</span> <span class="mi">123456789</span><span class="p">,</span>
  <span class="s2">"amount"</span> <span class="o">=&gt;</span> <span class="mi">50000</span><span class="p">,</span>
  <span class="s2">"description"</span> <span class="o">=&gt;</span> <span class="s2">"ZaloPay Intergration Demo"</span>
<span class="p">];</span>

<span class="c1">// app_id|zp_trans_id|amount|description|timestamp
</span><span class="nv">$data</span> <span class="o">=</span> <span class="nv">$params</span><span class="p">[</span><span class="s2">"app_id"</span><span class="p">]</span><span class="o">.</span><span class="s2">"|"</span><span class="o">.</span><span class="nv">$params</span><span class="p">[</span><span class="s2">"zp_trans_id"</span><span class="p">]</span><span class="o">.</span><span class="s2">"|"</span><span class="o">.</span><span class="nv">$params</span><span class="p">[</span><span class="s2">"amount"</span><span class="p">]</span>
  <span class="o">.</span><span class="s2">"|"</span><span class="o">.</span><span class="nv">$params</span><span class="p">[</span><span class="s2">"description"</span><span class="p">]</span><span class="o">.</span><span class="s2">"|"</span><span class="o">.</span><span class="nv">$params</span><span class="p">[</span><span class="s2">"timestamp"</span><span class="p">];</span>
<span class="nv">$params</span><span class="p">[</span><span class="s2">"mac"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s2">"sha256"</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s2">"key1"</span><span class="p">]);</span>

<span class="nv">$context</span> <span class="o">=</span> <span class="nb">stream_context_create</span><span class="p">([</span>
  <span class="s2">"http"</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s2">"header"</span> <span class="o">=&gt;</span> <span class="s2">"Content-type: application/x-www-form-urlencoded</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">,</span>
    <span class="s2">"method"</span> <span class="o">=&gt;</span> <span class="s2">"POST"</span><span class="p">,</span>
    <span class="s2">"content"</span> <span class="o">=&gt;</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$params</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">]);</span>

<span class="nv">$resp</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s2">"refund_url"</span><span class="p">],</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">$context</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$resp</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s2">"</span><span class="nv">$key</span><span class="s2">: </span><span class="nv">$value</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code><span class="c1"># ruby 2.5.1p57</span>

<span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span>
<span class="nb">require</span> <span class="s1">'net/http'</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">app_id: </span><span class="s1">'2553'</span><span class="p">,</span>
  <span class="ss">key1: </span><span class="s1">'PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL'</span><span class="p">,</span>
  <span class="ss">key2: </span><span class="s1">'kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz'</span><span class="p">,</span>
  <span class="ss">refund_url: </span><span class="s1">'https://sb-openapi.zalopay.vn/v2/refund'</span>
<span class="p">}</span>

<span class="n">app_id</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="ss">:app_id</span><span class="p">]</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_f</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">).</span><span class="nf">to_i</span>
<span class="n">uid</span> <span class="o">=</span> <span class="n">timestamp</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">''</span> <span class="o">+</span> <span class="p">(</span><span class="mi">111</span> <span class="o">+</span> <span class="no">Random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">888</span><span class="p">)).</span><span class="nf">to_s</span> <span class="c1"># unique id</span>
<span class="n">m_refund_id</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="s1">'%y%m%d'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'_'</span> <span class="o">+</span> <span class="n">app_id</span> <span class="o">+</span> <span class="s1">'_'</span> <span class="o">+</span> <span class="n">uid</span>

<span class="n">order</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">app_id: </span><span class="n">app_id</span><span class="p">,</span>
  <span class="ss">zp_trans_id: </span><span class="s2">"123456789"</span><span class="p">,</span>
  <span class="ss">m_refund_id: </span><span class="n">m_refund_id</span><span class="p">,</span>
  <span class="ss">timestamp: </span><span class="n">timestamp</span><span class="p">,</span>
  <span class="ss">amount: </span><span class="mi">50_000</span><span class="p">,</span>
  <span class="ss">description: </span><span class="s1">'ZaloPay Integration Demo'</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># app_id|zptransid|amount|description|timestamp</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">app_id</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">order</span><span class="p">[</span><span class="ss">:zp_trans_id</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">order</span><span class="p">[</span><span class="ss">:amount</span><span class="p">].</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">order</span><span class="p">[</span><span class="ss">:description</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">order</span><span class="p">[</span><span class="ss">:timestamp</span><span class="p">].</span><span class="nf">to_s</span>

<span class="n">order</span><span class="p">[</span><span class="ss">:mac</span><span class="p">]</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="ss">:key1</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">post_form</span><span class="p">(</span><span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="ss">:refund_url</span><span class="p">]),</span> <span class="n">order</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>

<span class="n">result</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre><pre class="highlight python tab-python"><code><span class="c"># coding=utf-8</span>
<span class="c"># Python 3.6</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">random</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">hmac</span><span class="p">,</span> <span class="n">hashlib</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"app_id"</span><span class="p">:</span> <span class="mi">2553</span><span class="p">,</span>
  <span class="s">"key1"</span><span class="p">:</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
  <span class="s">"key2"</span><span class="p">:</span> <span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
  <span class="s">"refund_url"</span><span class="p">:</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/refund"</span>
<span class="p">}</span>

<span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span> <span class="c"># miliseconds</span>
<span class="n">uid</span> <span class="o">=</span>  <span class="s">"{}{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="mi">999</span><span class="p">))</span> <span class="c"># unique id</span>

<span class="n">order</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"app_id"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"app_id"</span><span class="p">],</span>
  <span class="s">"m_refund_id"</span><span class="p">:</span> <span class="s">"{:</span><span class="si">%</span><span class="s">y</span><span class="si">%</span><span class="s">m</span><span class="si">%</span><span class="s">d}_{}_{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">config</span><span class="p">[</span><span class="s">"app_id"</span><span class="p">],</span> <span class="n">uid</span><span class="p">),</span>
  <span class="s">"timestamp"</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
  <span class="s">"zp_trans_id"</span><span class="p">:</span> <span class="mi">123456789</span><span class="p">,</span>
  <span class="s">"amount"</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="s">"description"</span><span class="p">:</span> <span class="s">"ZaloPay Integration Demo"</span><span class="p">,</span>
<span class="p">}</span>

<span class="c"># appid|zptransid|amount|description|timestamp</span>
<span class="n">data</span> <span class="o">=</span> <span class="s">"{}|{}|{}|{}|{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">order</span><span class="p">[</span><span class="s">"m_refund_id"</span><span class="p">],</span> <span class="n">order</span><span class="p">[</span><span class="s">"zp_trans_id"</span><span class="p">],</span> <span class="n">order</span><span class="p">[</span><span class="s">"amount"</span><span class="p">],</span> <span class="n">order</span><span class="p">[</span><span class="s">"description"</span><span class="p">],</span> <span class="n">order</span><span class="p">[</span><span class="s">"timestamp"</span><span class="p">])</span>
<span class="n">order</span><span class="p">[</span><span class="s">"mac"</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">'key1'</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"refund_url"</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"{}: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
</code></pre><pre class="highlight shell"><code>curl -X POST https://sandbox.zalopay.com.vn/v001/tpe/partialrefund <span class="se">\</span>
  -H <span class="s2">"Content-type: application/x-www-form-urlencoded"</span> <span class="se">\</span>
  -d <span class="nv">app_id</span><span class="o">=</span>2553 <span class="se">\</span>
  -d <span class="nv">m_refund_id</span><span class="o">=</span>190419_2553_352a73a0-6249-11e9-b146-9306e752a45c <span class="se">\</span>
  -d <span class="nv">timestamp</span><span class="o">=</span>1555640217561 <span class="se">\</span>
  -d <span class="nv">zp_trans_id</span><span class="o">=</span>1234567 <span class="se">\</span>
  -d <span class="nv">amount</span><span class="o">=</span>1000 <span class="se">\</span>
  -d <span class="nv">description</span><span class="o">=</span><span class="s1">'ZaloPay Integration Demo'</span> <span class="se">\</span>
  -d <span class="nv">mac</span><span class="o">=</span>5d826b55da6b97525d3eb80a7484922300ae5e2be7d51a35be8e34763a899d73
</code></pre>
<aside class="alert alert-primary">
<a href="/downloads/">Tải về các thư viện hỗ trợ tại đây</a>
</aside>
<h1 class='anchor-head' id='truy-van-trang-thai-hoan-tien-queryrefund'>Truy vấn trạng thái hoàn tiền - QueryRefund</h1>
<p>API cho phép đối tác gọi để truy vấn tình trạng hoàn tiền của 1 giao dịch hoàn tiền.</p>
<h2 class='anchor-head' id='truy-van-trang-thai-hoan-tien-queryrefund_luong-xu-ly'>Luồng xử lý</h2>
<p><img src="../../images/v2/queryrefund-v2.png" alt="Get refund status flow" /></p>
<h2 class='anchor-head' id='truy-van-trang-thai-hoan-tien-queryrefund_dac-ta-api'>Đặc tả API</h2>
<table><thead>
<tr>
<th>Environment</th>
<th>Method</th>
<th>Endpoint</th>
</tr>
</thead><tbody>
<tr>
<td><span class="code bg-orange">Sandbox</span></td>
<td><span class="code bg-success">POST</span></td>
<td>https://sb-openapi.zalopay.vn/v2/query_refund</td>
</tr>
<tr>
<td><span class="code bg-danger">Real</span></td>
<td><span class="code bg-success">POST</span></td>
<td>https://openapi.zalopay.vn/v2/query_refund</td>
</tr>
</tbody></table>

<ul>
<li><strong>Content-Type</strong>: </li>
</ul>

<p><code>application/x-www-form-urlencoded</code></p>

<p><code>application/json</code></p>

<p><code>application/xml</code></p>
<h3 class='anchor-head' id='truy-van-trang-thai-hoan-tien-queryrefund_dac-ta-api_du-lieu-truyen-vao-api'>Dữ liệu truyền vào api</h3>
<table><thead>
<tr>
<th style="text-align: left"><div style="width:140px">Tham số </div></th>
<th style="text-align: left">Kiểu dữ liệu</th>
<th style="text-align: left">Kích thước</th>
<th style="text-align: left">Bắt buộc</th>
<th style="text-align: left">Ý nghĩa</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>app_id</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left"></td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left"><code>app_id</code> của merchant được cung cấp</td>
</tr>
<tr>
<td style="text-align: left"><code>m_refund_id</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">45</td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">&bull; Mã giao dịch merchant tự gen đã truyền qua lúc gọi hoàn tiền.<br/> &bull; Định dạng: <code>yymmdd_appid_xxxxxxxxxx</code></td>
</tr>
<tr>
<td style="text-align: left"><code>timestamp</code></td>
<td style="text-align: left">Long</td>
<td style="text-align: left"></td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left">Thời điểm gọi api (timestamp in milisecond)</td>
</tr>
<tr>
<td style="text-align: left"><code>mac</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left"></td>
<td style="text-align: left">&#10004;</td>
<td style="text-align: left"><code>= HMAC(hmac_algorithm, key1, app_id+&quot;&#124;&quot;+m_refund_id+&quot;&#124;&quot;+timestamp)</code></td>
</tr>
</tbody></table>
<h3 class='anchor-head' id='truy-van-trang-thai-hoan-tien-queryrefund_dac-ta-api_tham-so-api-tra-ve'>Tham số api trả về</h3>
<table><thead>
<tr>
<th style="text-align: left">Tham số</th>
<th style="text-align: left">Kiểu dữ liệu</th>
<th style="text-align: left">Ý nghĩa</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>return_code</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left">Mã trạng thái</td>
</tr>
<tr>
<td style="text-align: left"><code>return_message</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Thông tin trạng thái</td>
</tr>
<tr>
<td style="text-align: left"><code>sub_return_code</code></td>
<td style="text-align: left">Int</td>
<td style="text-align: left">Mã trạng thái chi tiết</td>
</tr>
<tr>
<td style="text-align: left"><code>sub_return_message</code></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Mô tả chi tiết mã trạng thái</td>
</tr>
</tbody></table>
<h3 class='anchor-head' id='truy-van-trang-thai-hoan-tien-queryrefund_dac-ta-api_ma-trang-thai'>Mã trạng thái</h3>
<table><thead>
<tr>
<th style="text-align: left">Mã lỗi</th>
<th style="text-align: left">Miêu tả ngắn</th>
<th style="text-align: left">Ý nghĩa</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><code>1</code></td>
<td style="text-align: left">REFUND_SUCCESS</td>
<td style="text-align: left">Refund thành công.</td>
</tr>
<tr>
<td style="text-align: left"><code>2</code></td>
<td style="text-align: left">REFUND_FAIL</td>
<td style="text-align: left">Refund thất bại.</td>
</tr>
<tr>
<td style="text-align: left"><code>3</code></td>
<td style="text-align: left">PROCESSING</td>
<td style="text-align: left">Giao dịch đang được hoàn tiền.</td>
</tr>
<tr>
<td style="text-align: left"><code>-3</code></td>
<td style="text-align: left">Sai thông tin chứng thực.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><code>-10</code></td>
<td style="text-align: left">Sai thông tin app.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><code>-13</code></td>
<td style="text-align: left">Quá thời hạn cho phép hoàn tiền.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><code>-24</code></td>
<td style="text-align: left">Sai định dạng <code>m_refund_id</code>.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><code>-25</code></td>
<td style="text-align: left"><code>m_refund_id</code> có thời gian không đúng.</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><code>-26</code></td>
<td style="text-align: left"><code>m_refund_id</code> có appId không đúng.</td>
<td style="text-align: left"></td>
</tr>
</tbody></table>
<h2 class='anchor-head' id='truy-van-trang-thai-hoan-tien-queryrefund_code-mau'>Code mẫu</h2>
<div class="zlp-lang-selector"></div>
<pre class="highlight csharp tab-csharp"><code><span class="cm">/**
 * .Net core 2.1.505
 */</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ZaloPay.Helper</span><span class="p">;</span> <span class="c1">// HmacHelper, RSAHelper, HttpHelper, Utils (tải về ở mục DOWNLOADS)</span>
<span class="k">using</span> <span class="nn">ZaloPay.Helper.Crypto</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span> <span class="c1">// https://www.newtonsoft.com/json</span>

<span class="k">namespace</span> <span class="nn">ZaloPayExample</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">app_id</span> <span class="p">=</span> <span class="s">"2553"</span><span class="p">;</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">key1</span> <span class="p">=</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">;</span>
        <span class="k">static</span> <span class="kt">string</span> <span class="n">query_refund_url</span> <span class="p">=</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/query_refund"</span><span class="p">;</span>

        <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">param</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"app_id"</span><span class="p">,</span> <span class="n">app_id</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="s">"123456789"</span><span class="p">);</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"m_refund_id"</span><span class="p">,</span> <span class="s">"190308_2553_xxxxxx"</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="n">app_id</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"m_refund_id"</span><span class="p">]</span> <span class="p">+</span> <span class="s">"|"</span> <span class="p">+</span> <span class="n">param</span><span class="p">[</span><span class="s">"timestamp"</span><span class="p">];</span>
            <span class="n">param</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"mac"</span><span class="p">,</span> <span class="n">HmacHelper</span><span class="p">.</span><span class="nf">Compute</span><span class="p">(</span><span class="n">ZaloPayHMAC</span><span class="p">.</span><span class="n">HMACSHA256</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">data</span><span class="p">));</span>

            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">HttpHelper</span><span class="p">.</span><span class="nf">PostFormAsync</span><span class="p">(</span><span class="n">query_refund_url</span><span class="p">,</span> <span class="n">param</span><span class="p">);</span>

            <span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"{0} = {1}"</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// Java version "1.8.0_201"</span>
<span class="kn">import</span> <span class="nn">org.apache.http.NameValuePair</span><span class="o">;</span> <span class="c1">// https://mvnrepository.com/artifact/org.apache.httpcomponents/httpclient</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.entity.UrlEncodedFormEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.CloseableHttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.utils.URIBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.message.BasicNameValuePair</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.json.JSONObject</span><span class="o">;</span> <span class="c1">// https://mvnrepository.com/artifact/org.json/json</span>
<span class="kn">import</span> <span class="nn">vn.zalopay.crypto.HMACUtil</span><span class="o">;</span> <span class="c1">// tải về ở mục DOWNLOADS</span>
<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.URISyntaxException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GetRefundStatus</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;(){{</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">,</span> <span class="s">"2553"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"key1"</span><span class="o">,</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"key2"</span><span class="o">,</span> <span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"query_refund_url"</span><span class="o">,</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/query_refund"</span><span class="o">);</span>
    <span class="o">}};</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">m_refund_id</span> <span class="o">=</span> <span class="s">"190308_2553_123456"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span> <span class="c1">// miliseconds</span>
        <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">)</span> <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">m_refund_id</span>  <span class="o">+</span><span class="s">"|"</span><span class="o">+</span> <span class="n">timestamp</span><span class="o">;</span> <span class="c1">// app_id|m_refund_id|timestamp</span>
        <span class="n">String</span> <span class="n">mac</span> <span class="o">=</span> <span class="n">HMACUtil</span><span class="o">.</span><span class="na">HMacHexStringEncode</span><span class="o">(</span><span class="n">HMACUtil</span><span class="o">.</span><span class="na">HMACSHA256</span><span class="o">,</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"key1"</span><span class="o">),</span> <span class="n">data</span><span class="o">);</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">NameValuePair</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicNameValuePair</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">,</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"app_id"</span><span class="o">)));</span>
        <span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicNameValuePair</span><span class="o">(</span><span class="s">"m_refund_id"</span><span class="o">,</span> <span class="n">m_refund_id</span><span class="o">));</span>
        <span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicNameValuePair</span><span class="o">(</span><span class="s">"timestamp"</span><span class="o">,</span> <span class="n">timestamp</span><span class="o">));</span>
        <span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicNameValuePair</span><span class="o">(</span><span class="s">"mac"</span><span class="o">,</span> <span class="n">mac</span><span class="o">));</span>

        <span class="n">URIBuilder</span> <span class="n">uri</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URIBuilder</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"query_refund_url"</span><span class="o">));</span>
        <span class="n">uri</span><span class="o">.</span><span class="na">addParameters</span><span class="o">(</span><span class="n">params</span><span class="o">);</span>

        <span class="n">CloseableHttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
        <span class="n">HttpPost</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
        <span class="n">post</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="k">new</span> <span class="n">UrlEncodedFormEntity</span><span class="o">(</span><span class="n">params</span><span class="o">));</span>

        <span class="n">CloseableHttpResponse</span> <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
        <span class="n">BufferedReader</span> <span class="n">rd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="na">getEntity</span><span class="o">().</span><span class="na">getContent</span><span class="o">()));</span>
        <span class="n">StringBuilder</span> <span class="n">resultJsonStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">line</span><span class="o">;</span>

        <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">resultJsonStr</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">JSONObject</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="n">resultJsonStr</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">key</span> <span class="o">:</span> <span class="n">result</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%s = %s\n"</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre><pre class="highlight go tab-go"><code><span class="c">// go version go1.11.1 linux/amd64</span><span class="x">
</span><span class="k">package</span><span class="x"> </span><span class="n">main</span><span class="x">

</span><span class="k">import</span><span class="x"> </span><span class="p">(</span><span class="x">
    </span><span class="s">"encoding/json"</span><span class="x">
    </span><span class="s">"fmt"</span><span class="x">
    </span><span class="s">"io/ioutil"</span><span class="x">
    </span><span class="s">"log"</span><span class="x">
    </span><span class="s">"net/http"</span><span class="x">
    </span><span class="s">"net/url"</span><span class="x">
    </span><span class="s">"strconv"</span><span class="x">

    </span><span class="s">"github.com/zpmep/hmacutil"</span><span class="x"> </span><span class="c">// go get github.com/zpmep/hmacutil</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">var</span><span class="x"> </span><span class="p">(</span><span class="x">
    </span><span class="n">appID</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="s">"2553"</span><span class="x">
    </span><span class="n">key1</span><span class="x">  </span><span class="o">=</span><span class="x"> </span><span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="x">
    </span><span class="n">key2</span><span class="x">  </span><span class="o">=</span><span class="x"> </span><span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="x">
</span><span class="p">)</span><span class="x">

</span><span class="k">func</span><span class="x"> </span><span class="n">main</span><span class="p">()</span><span class="x"> </span><span class="p">{</span><span class="x">
    </span><span class="n">params</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}{</span><span class="x">
        </span><span class="s">"app_id"</span><span class="o">:</span><span class="x">       </span><span class="n">appID</span><span class="p">,</span><span class="x">
        </span><span class="s">"m_refund_id"</span><span class="o">:</span><span class="x"> </span><span class="n">appTransID</span><span class="p">,</span><span class="x">
    </span><span class="s">"timestamp"</span><span class="o">:</span><span class="x">  </span><span class="n">strconv</span><span class="o">.</span><span class="n">Itoa</span><span class="p">(</span><span class="m">12345678910</span><span class="p">),</span><span class="x">  </span><span class="c">// miliseconds</span><span class="x">
  </span><span class="p">}</span><span class="x">
    </span><span class="n">data</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%v|%v|%v"</span><span class="p">,</span><span class="x"> </span><span class="n">appID</span><span class="p">,</span><span class="x"> </span><span class="n">params</span><span class="p">[</span><span class="s">"m_refund_id"</span><span class="p">],</span><span class="x"> </span><span class="n">params</span><span class="p">[</span><span class="s">"timestamp"</span><span class="p">])</span><span class="x"> </span><span class="c">// app_id|m_refund_id|timestamp</span><span class="x">
  </span><span class="n">params</span><span class="p">[</span><span class="s">"mac"</span><span class="p">]</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="n">hmacutil</span><span class="o">.</span><span class="n">HexStringEncode</span><span class="p">(</span><span class="n">hmacutil</span><span class="o">.</span><span class="n">SHA256</span><span class="p">,</span><span class="x"> </span><span class="n">key1</span><span class="p">,</span><span class="x"> </span><span class="n">data</span><span class="p">)</span><span class="x">

  </span><span class="n">jsonStr</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="x">
    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
  </span><span class="p">}</span><span class="x">

  </span><span class="n">res</span><span class="p">,</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">http</span><span class="o">.</span><span class="n">Post</span><span class="p">(</span><span class="s">"https://sb-openapi.zalopay.vn/v2/query_refund"</span><span class="p">,</span><span class="x"> </span><span class="s">"application/json"</span><span class="p">,</span><span class="x"> </span><span class="n">bytes</span><span class="o">.</span><span class="n">NewBuffer</span><span class="p">(</span><span class="n">jsonStr</span><span class="p">))</span><span class="x">

    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
    </span><span class="k">defer</span><span class="x"> </span><span class="n">res</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span><span class="x">

    </span><span class="n">body</span><span class="p">,</span><span class="x"> </span><span class="n">_</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">ioutil</span><span class="o">.</span><span class="n">ReadAll</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span><span class="x">

    </span><span class="k">var</span><span class="x"> </span><span class="n">result</span><span class="x"> </span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}</span><span class="x">

    </span><span class="k">if</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">(</span><span class="n">body</span><span class="p">,</span><span class="x"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">);</span><span class="x"> </span><span class="n">err</span><span class="x"> </span><span class="o">!=</span><span class="x"> </span><span class="no">nil</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">

    </span><span class="k">for</span><span class="x"> </span><span class="n">k</span><span class="p">,</span><span class="x"> </span><span class="n">v</span><span class="x"> </span><span class="o">:=</span><span class="x"> </span><span class="k">range</span><span class="x"> </span><span class="n">result</span><span class="x"> </span><span class="p">{</span><span class="x">
        </span><span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%s = %+v"</span><span class="p">,</span><span class="x"> </span><span class="n">k</span><span class="p">,</span><span class="x"> </span><span class="n">v</span><span class="p">)</span><span class="x">
    </span><span class="p">}</span><span class="x">
</span><span class="p">}</span><span class="x">
</span></code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// Node v10.15.3</span>
<span class="kr">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'axios'</span><span class="p">).</span><span class="k">default</span><span class="p">;</span> <span class="c1">// npm install axios</span>
<span class="kr">const</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'crypto-js'</span><span class="p">);</span> <span class="c1">// npm install crypto-js</span>

<span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">app_id</span><span class="p">:</span> <span class="s2">"2553"</span><span class="p">,</span>
  <span class="na">key1</span><span class="p">:</span> <span class="s2">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
  <span class="na">key2</span><span class="p">:</span> <span class="s2">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
  <span class="na">endpoint</span><span class="p">:</span> <span class="s2">"https://sb-openapi.zalopay.vn/v2/query_refund"</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">app_id</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">app_id</span><span class="p">,</span>
  <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span> <span class="c1">// miliseconds</span>
  <span class="na">m_refund_id</span><span class="p">:</span> <span class="s2">"190312_2553_123456"</span><span class="p">,</span> 
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">app_id</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">m_refund_id</span> <span class="o">+</span> <span class="s2">"|"</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">;</span> <span class="c1">// app_id|m_refund_id|timestamp</span>
<span class="nx">params</span><span class="p">.</span><span class="nx">mac</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA256</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">key1</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>

<span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span> <span class="nx">params</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">))</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

<span class="c1">// PHP Version 7.3.3
</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"app_id"</span> <span class="o">=&gt;</span> <span class="mi">2553</span><span class="p">,</span>
  <span class="s2">"key1"</span> <span class="o">=&gt;</span> <span class="s2">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
  <span class="s2">"key2"</span> <span class="o">=&gt;</span> <span class="s2">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
  <span class="s2">"endpoint"</span> <span class="o">=&gt;</span> <span class="s2">"https://sb-openapi.zalopay.vn/v2/query_refund"</span>
<span class="p">];</span>

<span class="nv">$m_refund_id</span> <span class="o">=</span> <span class="s2">"190308_2553_123456"</span><span class="p">;</span> 
<span class="nv">$timestamp</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">microtime</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span> <span class="c1">// miliseconds
</span><span class="nv">$data</span> <span class="o">=</span> <span class="nv">$config</span><span class="p">[</span><span class="s2">"app_id"</span><span class="p">]</span><span class="o">.</span><span class="s2">"|"</span><span class="o">.</span><span class="nv">$m_refund_id</span><span class="o">.</span><span class="s2">"|"</span><span class="o">.</span><span class="nv">$timestamp</span><span class="p">;</span> <span class="c1">// app_id|m_refund_id|timestamp
</span><span class="nv">$params</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">"app_id"</span> <span class="o">=&gt;</span> <span class="nv">$config</span><span class="p">[</span><span class="s2">"app_id"</span><span class="p">],</span>
  <span class="s2">"timestamp"</span> <span class="o">=&gt;</span> <span class="nv">$timestamp</span><span class="p">,</span>
  <span class="s2">"m_refund_id"</span> <span class="o">=&gt;</span> <span class="nv">$m_refund_id</span><span class="p">,</span>
  <span class="s2">"mac"</span> <span class="o">=&gt;</span> <span class="nb">hash_hmac</span><span class="p">(</span><span class="s2">"sha256"</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s2">"key1"</span><span class="p">])</span>
<span class="p">];</span>

<span class="nv">$context</span> <span class="o">=</span> <span class="nb">stream_context_create</span><span class="p">([</span>
    <span class="s2">"http"</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s2">"header"</span> <span class="o">=&gt;</span> <span class="s2">"Content-type: application/x-www-form-urlencoded</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">,</span>
        <span class="s2">"method"</span> <span class="o">=&gt;</span> <span class="s2">"POST"</span><span class="p">,</span>
        <span class="s2">"content"</span> <span class="o">=&gt;</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$params</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">]);</span>

<span class="nv">$resp</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s2">"endpoint"</span><span class="p">],</span> <span class="kc">false</span><span class="p">,</span> <span class="nv">$context</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$resp</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s2">"</span><span class="nv">$key</span><span class="s2">: </span><span class="nv">$value</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code><span class="c1"># ruby 2.5.1p57</span>

<span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span> <span class="c1"># gem install openssl</span>
<span class="nb">require</span> <span class="s1">'net/http'</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">app_id: </span><span class="s1">'2553'</span><span class="p">,</span>
  <span class="ss">key1: </span><span class="s1">'PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL'</span><span class="p">,</span>
  <span class="ss">key2: </span><span class="s1">'kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz'</span><span class="p">,</span>
  <span class="ss">endpoint: </span><span class="s1">'https://sb-openapi.zalopay.vn/v2/query_refund'</span>
<span class="p">}</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">app_id: </span><span class="n">config</span><span class="p">[</span><span class="ss">:app_id</span><span class="p">],</span>
  <span class="ss">m_refund_id: </span><span class="s2">"190312_2553_123456"</span><span class="p">,</span>
  <span class="ss">timestamp: </span><span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_f</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">).</span><span class="nf">to_i</span> <span class="c1"># miliseconds</span>
<span class="p">}</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="ss">:app_id</span><span class="p">]</span> <span class="o">+</span><span class="s2">"|"</span><span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="ss">:m_refund_id</span><span class="p">]</span> <span class="o">+</span><span class="s2">"|"</span><span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="ss">:timestamp</span><span class="p">].</span><span class="nf">to_s</span> <span class="c1"># app_id|m_refund_id|timestamp</span>
<span class="n">params</span><span class="p">[</span><span class="ss">:mac</span><span class="p">]</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="ss">:key1</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">post_form</span><span class="p">(</span><span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="ss">:endpoint</span><span class="p">]),</span> <span class="n">params</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>

<span class="n">result</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre><pre class="highlight python tab-python"><code><span class="c"># coding=utf-8</span>
<span class="c"># Python 3.6</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="nn">hmac</span><span class="p">,</span> <span class="n">hashlib</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"app_id"</span><span class="p">:</span> <span class="mi">2553</span><span class="p">,</span>
  <span class="s">"key1"</span><span class="p">:</span> <span class="s">"PcY4iZIKFCIdgZvA6ueMcMHHUbRLYjPL"</span><span class="p">,</span>
  <span class="s">"key2"</span><span class="p">:</span> <span class="s">"kLtgPl8HHhfvMuDHPwKfgfsY4Ydm9eIz"</span><span class="p">,</span>
  <span class="s">"endpoint"</span><span class="p">:</span> <span class="s">"https://sb-openapi.zalopay.vn/v2/query_refund"</span>
<span class="p">}</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"app_id"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"app_id"</span><span class="p">],</span>
  <span class="s">"timestamp"</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)),</span> <span class="c"># miliseconds</span>
  <span class="s">"m_refund_id"</span><span class="p">:</span> <span class="s">"190409_2553_123456"</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">data</span> <span class="o">=</span> <span class="s">"{}|{}|{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">"app_id"</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">"m_refund_id"</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s">"timestamp"</span><span class="p">])</span> <span class="c"># app_id|m_refund_id|timestamp</span>
<span class="n">params</span><span class="p">[</span><span class="s">"mac"</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">"key1"</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"endpoint"</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"{}: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
</code></pre><pre class="highlight shell tab-shell"><code>curl https://sb-openapi.zalopay.vn/v2/query_refund <span class="se">\</span>
  -d <span class="nv">app_id</span><span class="o">=</span>2553 <span class="se">\</span>
  -d <span class="nv">timestamp</span><span class="o">=</span>1555640469224 <span class="se">\</span>
  -d <span class="nv">m_refund_id</span><span class="o">=</span>190308_2553_123456 <span class="se">\</span>
  -d <span class="nv">mac</span><span class="o">=</span>4255035bae2e65118887bc17110ab4b43a1cdd7c513aad9b25a5ef27e187196e
</code></pre>
<aside class="alert alert-primary">
<a href="/downloads/">Tải về các thư viện hỗ trợ tại đây</a>
</aside>

    </div>
  </div>


  <footer class="footer">
    <div class="copyright">
      &copy;
      <script>
        document.write(new Date().getFullYear())
      </script>, bản quyền của
      <a href="https://zalopay.vn/" target="_blank">ZaloPay</a>
    </div>
	</footer>

  <div id="searchResult">
    <div data-bind="visible: show" style="display: none">
      <div class="search-cover position-fixed bg-dark" data-bind="click: $root.close"></div>
      <div class="search-result position-fixed w-100 px-2" data-bind="click: $root.close">
        <div id="resultContainer" class="body bg-white rounded mx-auto p-4">
          <div data-bind="visible: $root.found()">
            <div data-bind="foreach: result">
              <a class="item d-block p-3 rounded"
                data-bind="attr: { href: href, id: 'result-' + $index() }, css: { current: $root.currRow() == $index() }">
                <p class="text-muted mb-1 font-weight-bold item-route">
                  <small data-bind="html: route"></small>
                </p>
                <p class="text-zlp font-weight-bold mb-1 item-title" data-bind="html: title"></p>
                <p class="text-muted mb-0 item-body">
                  <small data-bind="html: body"></small>
                </p>
              </a>
            </div>
          </div>
          <div class="p-3" data-bind="visible: !$root.found()" style="font-weight: 400">
            Không tìm thấy kết quả phù hợp
          </div>
        </div>
      </div>
    </div>
  </div>


  <script>
  window._I18n = {
    locale: 'vi',
    default: 'vi',
    langs: ['en'],
  }
  </script>

  <script src="../../javascripts/main.js"></script>
  <script src="../../javascripts/search.js"></script>

  <script>
    $('#languageSelection').val('vi')
  </script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-R6X6TMGKD3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-R6X6TMGKD3');
  </script>


    <script src="../../javascripts/docs.js"></script>
    <script src="../../javascripts/zlp/langSelector.js"></script>
</body>
</html>
